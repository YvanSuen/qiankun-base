{"remainingRequest":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js!D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\legacy\\sandbox.js","dependencies":[{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\legacy\\sandbox.js","mtime":1631881155000},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618900774989},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js","mtime":1618886346176}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWZsZWN0LmRlZmluZS1wcm9wZXJ0eS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgeyBTYW5kQm94VHlwZSB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMnOwppbXBvcnQgeyBnZXRUYXJnZXRWYWx1ZSB9IGZyb20gJy4uL2NvbW1vbic7CgpmdW5jdGlvbiBpc1Byb3BDb25maWd1cmFibGUodGFyZ2V0LCBwcm9wKSB7CiAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwgcHJvcCk7CiAgcmV0dXJuIGRlc2NyaXB0b3IgPyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA6IHRydWU7Cn0KLyoqCiAqIOWfuuS6jiBQcm94eSDlrp7njrDnmoTmspnnrrEKICogVE9ETzog5Li65LqG5YW85a655oCnIHNpbmd1bGFyIOaooeW8j+S4i+S+neaXp+S9v+eUqOivpeaymeeuse+8jOetieaWsOaymeeuseeos+WumuS5i+WQjuWGjeWIh+aNogogKi8KCgp2YXIgTGVnYWN5U2FuZGJveCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gTGVnYWN5U2FuZGJveChuYW1lKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHZhciBnbG9iYWxDb250ZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB3aW5kb3c7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExlZ2FjeVNhbmRib3gpOwogICAgLyoqIOaymeeuseacn+mXtOaWsOWinueahOWFqOWxgOWPmOmHjyAqLwoKCiAgICB0aGlzLmFkZGVkUHJvcHNNYXBJblNhbmRib3ggPSBuZXcgTWFwKCk7CiAgICAvKiog5rKZ566x5pyf6Ze05pu05paw55qE5YWo5bGA5Y+Y6YePICovCgogICAgdGhpcy5tb2RpZmllZFByb3BzT3JpZ2luYWxWYWx1ZU1hcEluU2FuZGJveCA9IG5ldyBNYXAoKTsKICAgIC8qKiDmjIHnu63orrDlvZXmm7TmlrDnmoQo5paw5aKe5ZKM5L+u5pS555qEKeWFqOWxgOWPmOmHj+eahCBtYXDvvIznlKjkuo7lnKjku7vmhI/ml7bliLvlgZogc25hcHNob3QgKi8KCiAgICB0aGlzLmN1cnJlbnRVcGRhdGVkUHJvcHNWYWx1ZU1hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuc2FuZGJveFJ1bm5pbmcgPSB0cnVlOwogICAgdGhpcy5sYXRlc3RTZXRQcm9wID0gbnVsbDsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLmdsb2JhbENvbnRleHQgPSBnbG9iYWxDb250ZXh0OwogICAgdGhpcy50eXBlID0gU2FuZEJveFR5cGUuTGVnYWN5UHJveHk7CiAgICB2YXIgYWRkZWRQcm9wc01hcEluU2FuZGJveCA9IHRoaXMuYWRkZWRQcm9wc01hcEluU2FuZGJveCwKICAgICAgICBtb2RpZmllZFByb3BzT3JpZ2luYWxWYWx1ZU1hcEluU2FuZGJveCA9IHRoaXMubW9kaWZpZWRQcm9wc09yaWdpbmFsVmFsdWVNYXBJblNhbmRib3gsCiAgICAgICAgY3VycmVudFVwZGF0ZWRQcm9wc1ZhbHVlTWFwID0gdGhpcy5jdXJyZW50VXBkYXRlZFByb3BzVmFsdWVNYXA7CiAgICB2YXIgcmF3V2luZG93ID0gZ2xvYmFsQ29udGV4dDsKICAgIHZhciBmYWtlV2luZG93ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgICB2YXIgc2V0VHJhcCA9IGZ1bmN0aW9uIHNldFRyYXAocCwgdmFsdWUsIG9yaWdpbmFsVmFsdWUpIHsKICAgICAgdmFyIHN5bmMyV2luZG93ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiB0cnVlOwoKICAgICAgaWYgKF90aGlzLnNhbmRib3hSdW5uaW5nKSB7CiAgICAgICAgaWYgKCFyYXdXaW5kb3cuaGFzT3duUHJvcGVydHkocCkpIHsKICAgICAgICAgIGFkZGVkUHJvcHNNYXBJblNhbmRib3guc2V0KHAsIHZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKCFtb2RpZmllZFByb3BzT3JpZ2luYWxWYWx1ZU1hcEluU2FuZGJveC5oYXMocCkpIHsKICAgICAgICAgIC8vIOWmguaenOW9k+WJjSB3aW5kb3cg5a+56LGh5a2Y5Zyo6K+l5bGe5oCn77yM5LiUIHJlY29yZCBtYXAg5Lit5pyq6K6w5b2V6L+H77yM5YiZ6K6w5b2V6K+l5bGe5oCn5Yid5aeL5YC8CiAgICAgICAgICBtb2RpZmllZFByb3BzT3JpZ2luYWxWYWx1ZU1hcEluU2FuZGJveC5zZXQocCwgb3JpZ2luYWxWYWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBjdXJyZW50VXBkYXRlZFByb3BzVmFsdWVNYXAuc2V0KHAsIHZhbHVlKTsKCiAgICAgICAgaWYgKHN5bmMyV2luZG93KSB7CiAgICAgICAgICAvLyDlv4Xpobvph43mlrDorr7nva4gd2luZG93IOWvueixoeS/neivgeS4i+asoSBnZXQg5pe26IO95ou/5Yiw5bey5pu05paw55qE5pWw5o2uCiAgICAgICAgICByYXdXaW5kb3dbcF0gPSB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIF90aGlzLmxhdGVzdFNldFByb3AgPSBwOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHsKICAgICAgICBjb25zb2xlLndhcm4oIltxaWFua3VuXSBTZXQgd2luZG93LiIuY29uY2F0KHAudG9TdHJpbmcoKSwgIiB3aGlsZSBzYW5kYm94IGRlc3Ryb3llZCBvciBpbmFjdGl2ZSBpbiAiKS5jb25jYXQobmFtZSwgIiEiKSk7CiAgICAgIH0gLy8g5ZyoIHN0cmljdC1tb2RlIOS4i++8jFByb3h5IOeahCBoYW5kbGVyLnNldCDov5Tlm54gZmFsc2Ug5Lya5oqb5Ye6IFR5cGVFcnJvcu+8jOWcqOaymeeuseWNuOi9veeahOaDheWGteS4i+W6lOivpeW/veeVpemUmeivrwoKCiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKCiAgICB2YXIgcHJveHkgPSBuZXcgUHJveHkoZmFrZVdpbmRvdywgewogICAgICBzZXQ6IGZ1bmN0aW9uIHNldChfLCBwLCB2YWx1ZSkgewogICAgICAgIHZhciBvcmlnaW5hbFZhbHVlID0gcmF3V2luZG93W3BdOwogICAgICAgIHJldHVybiBzZXRUcmFwKHAsIHZhbHVlLCBvcmlnaW5hbFZhbHVlLCB0cnVlKTsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoXywgcCkgewogICAgICAgIC8vIGF2b2lkIHdobyB1c2luZyB3aW5kb3cud2luZG93IG9yIHdpbmRvdy5zZWxmIHRvIGVzY2FwZSB0aGUgc2FuZGJveCBlbnZpcm9ubWVudCB0byB0b3VjaCB0aGUgcmVhbGx5IHdpbmRvdwogICAgICAgIC8vIG9yIHVzZSB3aW5kb3cudG9wIHRvIGNoZWNrIGlmIGFuIGlmcmFtZSBjb250ZXh0CiAgICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGlncmV5L0ZpbGVTYXZlci5qcy9ibG9iL21hc3Rlci9zcmMvRmlsZVNhdmVyLmpzI0wxMwogICAgICAgIGlmIChwID09PSAndG9wJyB8fCBwID09PSAncGFyZW50JyB8fCBwID09PSAnd2luZG93JyB8fCBwID09PSAnc2VsZicpIHsKICAgICAgICAgIHJldHVybiBwcm94eTsKICAgICAgICB9CgogICAgICAgIHZhciB2YWx1ZSA9IHJhd1dpbmRvd1twXTsKICAgICAgICByZXR1cm4gZ2V0VGFyZ2V0VmFsdWUocmF3V2luZG93LCB2YWx1ZSk7CiAgICAgIH0sCiAgICAgIC8vIHRyYXAgaW4gb3BlcmF0b3IKICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9zdHlsZWQtY29tcG9uZW50cy9zdHlsZWQtY29tcG9uZW50cy9ibG9iL21hc3Rlci9wYWNrYWdlcy9zdHlsZWQtY29tcG9uZW50cy9zcmMvY29uc3RhbnRzLmpzI0wxMgogICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhfLCBwKSB7CiAgICAgICAgcmV0dXJuIHAgaW4gcmF3V2luZG93OwogICAgICB9LAogICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihfLCBwKSB7CiAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHJhd1dpbmRvdywgcCk7IC8vIEEgcHJvcGVydHkgY2Fubm90IGJlIHJlcG9ydGVkIGFzIG5vbi1jb25maWd1cmFibGUsIGlmIGl0IGRvZXMgbm90IGV4aXN0cyBhcyBhbiBvd24gcHJvcGVydHkgb2YgdGhlIHRhcmdldCBvYmplY3QKCiAgICAgICAgaWYgKGRlc2NyaXB0b3IgJiYgIWRlc2NyaXB0b3IuY29uZmlndXJhYmxlKSB7CiAgICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGVzY3JpcHRvcjsKICAgICAgfSwKICAgICAgZGVmaW5lUHJvcGVydHk6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KF8sIHAsIGF0dHJpYnV0ZXMpIHsKICAgICAgICB2YXIgb3JpZ2luYWxWYWx1ZSA9IHJhd1dpbmRvd1twXTsKICAgICAgICB2YXIgZG9uZSA9IFJlZmxlY3QuZGVmaW5lUHJvcGVydHkocmF3V2luZG93LCBwLCBhdHRyaWJ1dGVzKTsKICAgICAgICB2YXIgdmFsdWUgPSByYXdXaW5kb3dbcF07CiAgICAgICAgc2V0VHJhcChwLCB2YWx1ZSwgb3JpZ2luYWxWYWx1ZSwgZmFsc2UpOwogICAgICAgIHJldHVybiBkb25lOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMucHJveHkgPSBwcm94eTsKICB9CgogIF9jcmVhdGVDbGFzcyhMZWdhY3lTYW5kYm94LCBbewogICAga2V5OiAic2V0V2luZG93UHJvcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0V2luZG93UHJvcChwcm9wLCB2YWx1ZSwgdG9EZWxldGUpIHsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYgdG9EZWxldGUpIHsKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24KICAgICAgICBkZWxldGUgdGhpcy5nbG9iYWxDb250ZXh0W3Byb3BdOwogICAgICB9IGVsc2UgaWYgKGlzUHJvcENvbmZpZ3VyYWJsZSh0aGlzLmdsb2JhbENvbnRleHQsIHByb3ApICYmIF90eXBlb2YocHJvcCkgIT09ICdzeW1ib2wnKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMuZ2xvYmFsQ29udGV4dCwgcHJvcCwgewogICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduCgogICAgICAgIHRoaXMuZ2xvYmFsQ29udGV4dFtwcm9wXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiYWN0aXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhY3RpdmUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLnNhbmRib3hSdW5uaW5nKSB7CiAgICAgICAgdGhpcy5jdXJyZW50VXBkYXRlZFByb3BzVmFsdWVNYXAuZm9yRWFjaChmdW5jdGlvbiAodiwgcCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMi5zZXRXaW5kb3dQcm9wKHAsIHYpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLnNhbmRib3hSdW5uaW5nID0gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbmFjdGl2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5hY3RpdmUoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7CiAgICAgICAgY29uc29sZS5pbmZvKCJbcWlhbmt1bjpzYW5kYm94XSAiLmNvbmNhdCh0aGlzLm5hbWUsICIgbW9kaWZpZWQgZ2xvYmFsIHByb3BlcnRpZXMgcmVzdG9yZS4uLiIpLCBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuYWRkZWRQcm9wc01hcEluU2FuZGJveC5rZXlzKCkpLCBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5tb2RpZmllZFByb3BzT3JpZ2luYWxWYWx1ZU1hcEluU2FuZGJveC5rZXlzKCkpKSk7CiAgICAgIH0gLy8gcmVuZGVyU2FuZGJveFNuYXBzaG90ID0gc25hcHNob3QoY3VycmVudFVwZGF0ZWRQcm9wc1ZhbHVlTWFwRm9yU25hcHNob3QpOwogICAgICAvLyByZXN0b3JlIGdsb2JhbCBwcm9wcyB0byBpbml0aWFsIHNuYXBzaG90CgoKICAgICAgdGhpcy5tb2RpZmllZFByb3BzT3JpZ2luYWxWYWx1ZU1hcEluU2FuZGJveC5mb3JFYWNoKGZ1bmN0aW9uICh2LCBwKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMy5zZXRXaW5kb3dQcm9wKHAsIHYpOwogICAgICB9KTsKICAgICAgdGhpcy5hZGRlZFByb3BzTWFwSW5TYW5kYm94LmZvckVhY2goZnVuY3Rpb24gKF8sIHApIHsKICAgICAgICByZXR1cm4gX3RoaXMzLnNldFdpbmRvd1Byb3AocCwgdW5kZWZpbmVkLCB0cnVlKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2FuZGJveFJ1bm5pbmcgPSBmYWxzZTsKICAgIH0KICB9XSk7CgogIHJldHVybiBMZWdhY3lTYW5kYm94Owp9KCk7CgpleHBvcnQgeyBMZWdhY3lTYW5kYm94IGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["D:/qiankun微前台/Demo/qiankun/qiankun-base/node_modules/qiankun/es/sandbox/legacy/sandbox.js"],"names":["_toConsumableArray","_typeof","_classCallCheck","_createClass","SandBoxType","getTargetValue","isPropConfigurable","target","prop","descriptor","Object","getOwnPropertyDescriptor","configurable","LegacySandbox","name","_this","globalContext","arguments","length","undefined","window","addedPropsMapInSandbox","Map","modifiedPropsOriginalValueMapInSandbox","currentUpdatedPropsValueMap","sandboxRunning","latestSetProp","type","LegacyProxy","rawWindow","fakeWindow","create","setTrap","p","value","originalValue","sync2Window","hasOwnProperty","set","has","process","env","NODE_ENV","console","warn","concat","toString","proxy","Proxy","_","get","defineProperty","attributes","done","Reflect","key","setWindowProp","toDelete","writable","active","_this2","forEach","v","inactive","_this3","info","keys","default"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport { SandBoxType } from '../../interfaces';\nimport { getTargetValue } from '../common';\n\nfunction isPropConfigurable(target, prop) {\n  var descriptor = Object.getOwnPropertyDescriptor(target, prop);\n  return descriptor ? descriptor.configurable : true;\n}\n/**\n * 基于 Proxy 实现的沙箱\n * TODO: 为了兼容性 singular 模式下依旧使用该沙箱，等新沙箱稳定之后再切换\n */\n\n\nvar LegacySandbox = /*#__PURE__*/function () {\n  function LegacySandbox(name) {\n    var _this = this;\n\n    var globalContext = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    _classCallCheck(this, LegacySandbox);\n\n    /** 沙箱期间新增的全局变量 */\n    this.addedPropsMapInSandbox = new Map();\n    /** 沙箱期间更新的全局变量 */\n\n    this.modifiedPropsOriginalValueMapInSandbox = new Map();\n    /** 持续记录更新的(新增和修改的)全局变量的 map，用于在任意时刻做 snapshot */\n\n    this.currentUpdatedPropsValueMap = new Map();\n    this.sandboxRunning = true;\n    this.latestSetProp = null;\n    this.name = name;\n    this.globalContext = globalContext;\n    this.type = SandBoxType.LegacyProxy;\n    var addedPropsMapInSandbox = this.addedPropsMapInSandbox,\n        modifiedPropsOriginalValueMapInSandbox = this.modifiedPropsOriginalValueMapInSandbox,\n        currentUpdatedPropsValueMap = this.currentUpdatedPropsValueMap;\n    var rawWindow = globalContext;\n    var fakeWindow = Object.create(null);\n\n    var setTrap = function setTrap(p, value, originalValue) {\n      var sync2Window = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n      if (_this.sandboxRunning) {\n        if (!rawWindow.hasOwnProperty(p)) {\n          addedPropsMapInSandbox.set(p, value);\n        } else if (!modifiedPropsOriginalValueMapInSandbox.has(p)) {\n          // 如果当前 window 对象存在该属性，且 record map 中未记录过，则记录该属性初始值\n          modifiedPropsOriginalValueMapInSandbox.set(p, originalValue);\n        }\n\n        currentUpdatedPropsValueMap.set(p, value);\n\n        if (sync2Window) {\n          // 必须重新设置 window 对象保证下次 get 时能拿到已更新的数据\n          rawWindow[p] = value;\n        }\n\n        _this.latestSetProp = p;\n        return true;\n      }\n\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(\"[qiankun] Set window.\".concat(p.toString(), \" while sandbox destroyed or inactive in \").concat(name, \"!\"));\n      } // 在 strict-mode 下，Proxy 的 handler.set 返回 false 会抛出 TypeError，在沙箱卸载的情况下应该忽略错误\n\n\n      return true;\n    };\n\n    var proxy = new Proxy(fakeWindow, {\n      set: function set(_, p, value) {\n        var originalValue = rawWindow[p];\n        return setTrap(p, value, originalValue, true);\n      },\n      get: function get(_, p) {\n        // avoid who using window.window or window.self to escape the sandbox environment to touch the really window\n        // or use window.top to check if an iframe context\n        // see https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L13\n        if (p === 'top' || p === 'parent' || p === 'window' || p === 'self') {\n          return proxy;\n        }\n\n        var value = rawWindow[p];\n        return getTargetValue(rawWindow, value);\n      },\n      // trap in operator\n      // see https://github.com/styled-components/styled-components/blob/master/packages/styled-components/src/constants.js#L12\n      has: function has(_, p) {\n        return p in rawWindow;\n      },\n      getOwnPropertyDescriptor: function getOwnPropertyDescriptor(_, p) {\n        var descriptor = Object.getOwnPropertyDescriptor(rawWindow, p); // A property cannot be reported as non-configurable, if it does not exists as an own property of the target object\n\n        if (descriptor && !descriptor.configurable) {\n          descriptor.configurable = true;\n        }\n\n        return descriptor;\n      },\n      defineProperty: function defineProperty(_, p, attributes) {\n        var originalValue = rawWindow[p];\n        var done = Reflect.defineProperty(rawWindow, p, attributes);\n        var value = rawWindow[p];\n        setTrap(p, value, originalValue, false);\n        return done;\n      }\n    });\n    this.proxy = proxy;\n  }\n\n  _createClass(LegacySandbox, [{\n    key: \"setWindowProp\",\n    value: function setWindowProp(prop, value, toDelete) {\n      if (value === undefined && toDelete) {\n        // eslint-disable-next-line no-param-reassign\n        delete this.globalContext[prop];\n      } else if (isPropConfigurable(this.globalContext, prop) && _typeof(prop) !== 'symbol') {\n        Object.defineProperty(this.globalContext, prop, {\n          writable: true,\n          configurable: true\n        }); // eslint-disable-next-line no-param-reassign\n\n        this.globalContext[prop] = value;\n      }\n    }\n  }, {\n    key: \"active\",\n    value: function active() {\n      var _this2 = this;\n\n      if (!this.sandboxRunning) {\n        this.currentUpdatedPropsValueMap.forEach(function (v, p) {\n          return _this2.setWindowProp(p, v);\n        });\n      }\n\n      this.sandboxRunning = true;\n    }\n  }, {\n    key: \"inactive\",\n    value: function inactive() {\n      var _this3 = this;\n\n      if (process.env.NODE_ENV === 'development') {\n        console.info(\"[qiankun:sandbox] \".concat(this.name, \" modified global properties restore...\"), [].concat(_toConsumableArray(this.addedPropsMapInSandbox.keys()), _toConsumableArray(this.modifiedPropsOriginalValueMapInSandbox.keys())));\n      } // renderSandboxSnapshot = snapshot(currentUpdatedPropsValueMapForSnapshot);\n      // restore global props to initial snapshot\n\n\n      this.modifiedPropsOriginalValueMapInSandbox.forEach(function (v, p) {\n        return _this3.setWindowProp(p, v);\n      });\n      this.addedPropsMapInSandbox.forEach(function (_, p) {\n        return _this3.setWindowProp(p, undefined, true);\n      });\n      this.sandboxRunning = false;\n    }\n  }]);\n\n  return LegacySandbox;\n}();\n\nexport { LegacySandbox as default };"]}]}