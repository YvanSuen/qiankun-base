{"remainingRequest":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js!D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\loader.js","dependencies":[{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\loader.js","mtime":1631881155000},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618900774989},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js","mtime":1618886346176}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgX2NvbmNhdCBmcm9tICJsb2Rhc2gvY29uY2F0IjsKaW1wb3J0IF9tZXJnZVdpdGgyIGZyb20gImxvZGFzaC9tZXJnZVdpdGgiOwppbXBvcnQgX3R5cGVvZiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgX2ZvckVhY2ggZnJvbSAibG9kYXNoL2ZvckVhY2giOwppbXBvcnQgX3JlZ2VuZXJhdG9yUnVudGltZSBmcm9tICJAYmFiZWwvcnVudGltZS9yZWdlbmVyYXRvciI7Ci8qKgogKiBAYXV0aG9yIEt1aXRvcwogKiBAc2luY2UgMjAyMC0wNC0wMQogKi8KCmltcG9ydCB7IF9fYXdhaXRlciwgX19yZXN0IH0gZnJvbSAidHNsaWIiOwppbXBvcnQgeyBpbXBvcnRFbnRyeSB9IGZyb20gJ2ltcG9ydC1odG1sLWVudHJ5JzsKaW1wb3J0IGdldEFkZE9ucyBmcm9tICcuL2FkZG9ucyc7CmltcG9ydCB7IFFpYW5rdW5FcnJvciB9IGZyb20gJy4vZXJyb3InOwppbXBvcnQgeyBnZXRNaWNyb0FwcFN0YXRlQWN0aW9ucyB9IGZyb20gJy4vZ2xvYmFsU3RhdGUnOwppbXBvcnQgeyBjcmVhdGVTYW5kYm94Q29udGFpbmVyLCBjc3MgfSBmcm9tICcuL3NhbmRib3gnOwppbXBvcnQgeyBEZWZlcnJlZCwgZ2V0Q29udGFpbmVyLCBnZXREZWZhdWx0VHBsV3JhcHBlciwgZ2V0V3JhcHBlcklkLCBpc0VuYWJsZVNjb3BlZENTUywgcGVyZm9ybWFuY2VNYXJrLCBwZXJmb3JtYW5jZU1lYXN1cmUsIHBlcmZvcm1hbmNlR2V0RW50cmllc0J5TmFtZSwgdG9BcnJheSwgdmFsaWRhdGVFeHBvcnRMaWZlY3ljbGUgfSBmcm9tICcuL3V0aWxzJzsKCmZ1bmN0aW9uIGFzc2VydEVsZW1lbnRFeGlzdChlbGVtZW50LCBtc2cpIHsKICBpZiAoIWVsZW1lbnQpIHsKICAgIGlmIChtc2cpIHsKICAgICAgdGhyb3cgbmV3IFFpYW5rdW5FcnJvcihtc2cpOwogICAgfQoKICAgIHRocm93IG5ldyBRaWFua3VuRXJyb3IoJ2VsZW1lbnQgbm90IGV4aXN0ZWQhJyk7CiAgfQp9CgpmdW5jdGlvbiBleGVjSG9va3NDaGFpbihob29rcywgYXBwKSB7CiAgdmFyIGdsb2JhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogd2luZG93OwoKICBpZiAoaG9va3MubGVuZ3RoKSB7CiAgICByZXR1cm4gaG9va3MucmVkdWNlKGZ1bmN0aW9uIChjaGFpbiwgaG9vaykgewogICAgICByZXR1cm4gY2hhaW4udGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGhvb2soYXBwLCBnbG9iYWwpOwogICAgICB9KTsKICAgIH0sIFByb21pc2UucmVzb2x2ZSgpKTsKICB9CgogIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKfQoKZnVuY3Rpb24gdmFsaWRhdGVTaW5ndWxhck1vZGUodmFsaWRhdGUsIGFwcCkgewogIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHR5cGVvZiB2YWxpZGF0ZSA9PT0gJ2Z1bmN0aW9uJyA/IHZhbGlkYXRlKGFwcCkgOiAhIXZhbGlkYXRlKTsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSk7CiAgfSkpOwp9IC8vIEB0cy1pZ25vcmUKCgp2YXIgc3VwcG9ydFNoYWRvd0RPTSA9IGRvY3VtZW50LmhlYWQuYXR0YWNoU2hhZG93IHx8IGRvY3VtZW50LmhlYWQuY3JlYXRlU2hhZG93Um9vdDsKCmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQoYXBwQ29udGVudCwgc3RyaWN0U3R5bGVJc29sYXRpb24sIHNjb3BlZENTUywgYXBwTmFtZSkgewogIHZhciBjb250YWluZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgY29udGFpbmVyRWxlbWVudC5pbm5lckhUTUwgPSBhcHBDb250ZW50OyAvLyBhcHBDb250ZW50IGFsd2F5cyB3cmFwcGVkIHdpdGggYSBzaW5ndWxhciBkaXYKCiAgdmFyIGFwcEVsZW1lbnQgPSBjb250YWluZXJFbGVtZW50LmZpcnN0Q2hpbGQ7CgogIGlmIChzdHJpY3RTdHlsZUlzb2xhdGlvbikgewogICAgaWYgKCFzdXBwb3J0U2hhZG93RE9NKSB7CiAgICAgIGNvbnNvbGUud2FybignW3FpYW5rdW5dOiBBcyBjdXJyZW50IGJyb3dzZXIgbm90IHN1cHBvcnQgc2hhZG93IGRvbSwgeW91ciBzdHJpY3RTdHlsZUlzb2xhdGlvbiBjb25maWd1cmF0aW9uIHdpbGwgYmUgaWdub3JlZCEnKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBpbm5lckhUTUwgPSBhcHBFbGVtZW50LmlubmVySFRNTDsKICAgICAgYXBwRWxlbWVudC5pbm5lckhUTUwgPSAnJzsKICAgICAgdmFyIHNoYWRvdzsKCiAgICAgIGlmIChhcHBFbGVtZW50LmF0dGFjaFNoYWRvdykgewogICAgICAgIHNoYWRvdyA9IGFwcEVsZW1lbnQuYXR0YWNoU2hhZG93KHsKICAgICAgICAgIG1vZGU6ICdvcGVuJwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGNyZWF0ZVNoYWRvd1Jvb3Qgd2FzIHByb3Bvc2VkIGluIGluaXRpYWwgc3BlYywgd2hpY2ggaGFzIHRoZW4gYmVlbiBkZXByZWNhdGVkCiAgICAgICAgc2hhZG93ID0gYXBwRWxlbWVudC5jcmVhdGVTaGFkb3dSb290KCk7CiAgICAgIH0KCiAgICAgIHNoYWRvdy5pbm5lckhUTUwgPSBpbm5lckhUTUw7CiAgICB9CiAgfQoKICBpZiAoc2NvcGVkQ1NTKSB7CiAgICB2YXIgYXR0ciA9IGFwcEVsZW1lbnQuZ2V0QXR0cmlidXRlKGNzcy5RaWFua3VuQ1NTUmV3cml0ZUF0dHIpOwoKICAgIGlmICghYXR0cikgewogICAgICBhcHBFbGVtZW50LnNldEF0dHJpYnV0ZShjc3MuUWlhbmt1bkNTU1Jld3JpdGVBdHRyLCBhcHBOYW1lKTsKICAgIH0KCiAgICB2YXIgc3R5bGVOb2RlcyA9IGFwcEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnc3R5bGUnKSB8fCBbXTsKCiAgICBfZm9yRWFjaChzdHlsZU5vZGVzLCBmdW5jdGlvbiAoc3R5bGVzaGVldEVsZW1lbnQpIHsKICAgICAgY3NzLnByb2Nlc3MoYXBwRWxlbWVudCwgc3R5bGVzaGVldEVsZW1lbnQsIGFwcE5hbWUpOwogICAgfSk7CiAgfQoKICByZXR1cm4gYXBwRWxlbWVudDsKfQovKiogZ2VuZXJhdGUgYXBwIHdyYXBwZXIgZG9tIGdldHRlciAqLwoKCmZ1bmN0aW9uIGdldEFwcFdyYXBwZXJHZXR0ZXIoYXBwTmFtZSwgYXBwSW5zdGFuY2VJZCwgdXNlTGVnYWN5UmVuZGVyLCBzdHJpY3RTdHlsZUlzb2xhdGlvbiwgc2NvcGVkQ1NTLCBlbGVtZW50R2V0dGVyKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIGlmICh1c2VMZWdhY3lSZW5kZXIpIHsKICAgICAgaWYgKHN0cmljdFN0eWxlSXNvbGF0aW9uKSB0aHJvdyBuZXcgUWlhbmt1bkVycm9yKCdzdHJpY3RTdHlsZUlzb2xhdGlvbiBjYW4gbm90IGJlIHVzZWQgd2l0aCBsZWdhY3kgcmVuZGVyIScpOwogICAgICBpZiAoc2NvcGVkQ1NTKSB0aHJvdyBuZXcgUWlhbmt1bkVycm9yKCdleHBlcmltZW50YWxTdHlsZUlzb2xhdGlvbiBjYW4gbm90IGJlIHVzZWQgd2l0aCBsZWdhY3kgcmVuZGVyIScpOwogICAgICB2YXIgYXBwV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGdldFdyYXBwZXJJZChhcHBJbnN0YW5jZUlkKSk7CiAgICAgIGFzc2VydEVsZW1lbnRFeGlzdChhcHBXcmFwcGVyLCAiV3JhcHBlciBlbGVtZW50IGZvciAiLmNvbmNhdChhcHBOYW1lLCAiIHdpdGggaW5zdGFuY2UgIikuY29uY2F0KGFwcEluc3RhbmNlSWQsICIgaXMgbm90IGV4aXN0ZWQhIikpOwogICAgICByZXR1cm4gYXBwV3JhcHBlcjsKICAgIH0KCiAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRHZXR0ZXIoKTsKICAgIGFzc2VydEVsZW1lbnRFeGlzdChlbGVtZW50LCAiV3JhcHBlciBlbGVtZW50IGZvciAiLmNvbmNhdChhcHBOYW1lLCAiIHdpdGggaW5zdGFuY2UgIikuY29uY2F0KGFwcEluc3RhbmNlSWQsICIgaXMgbm90IGV4aXN0ZWQhIikpOwoKICAgIGlmIChzdHJpY3RTdHlsZUlzb2xhdGlvbiAmJiBzdXBwb3J0U2hhZG93RE9NKSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNoYWRvd1Jvb3Q7CiAgICB9CgogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfTsKfQoKdmFyIHJhd0FwcGVuZENoaWxkID0gSFRNTEVsZW1lbnQucHJvdG90eXBlLmFwcGVuZENoaWxkOwp2YXIgcmF3UmVtb3ZlQ2hpbGQgPSBIVE1MRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlQ2hpbGQ7Ci8qKgogKiBHZXQgdGhlIHJlbmRlciBmdW5jdGlvbgogKiBJZiB0aGUgbGVnYWN5IHJlbmRlciBmdW5jdGlvbiBpcyBwcm92aWRlLCB1c2VkIGFzIGl0LCBvdGhlcndpc2Ugd2Ugd2lsbCBpbnNlcnQgdGhlIGFwcCBlbGVtZW50IHRvIHRhcmdldCBjb250YWluZXIgYnkgcWlhbmt1bgogKiBAcGFyYW0gYXBwTmFtZQogKiBAcGFyYW0gYXBwQ29udGVudAogKiBAcGFyYW0gbGVnYWN5UmVuZGVyCiAqLwoKZnVuY3Rpb24gZ2V0UmVuZGVyKGFwcE5hbWUsIGFwcENvbnRlbnQsIGxlZ2FjeVJlbmRlcikgewogIHZhciByZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoX3JlZiwgcGhhc2UpIHsKICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LAogICAgICAgIGxvYWRpbmcgPSBfcmVmLmxvYWRpbmcsCiAgICAgICAgY29udGFpbmVyID0gX3JlZi5jb250YWluZXI7CgogICAgaWYgKGxlZ2FjeVJlbmRlcikgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1txaWFua3VuXSBDdXN0b20gcmVuZGVyaW5nIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBjYW4gdXNlIHRoZSBjb250YWluZXIgZWxlbWVudCBzZXR0aW5nIGluc3RlYWQhJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBsZWdhY3lSZW5kZXIoewogICAgICAgIGxvYWRpbmc6IGxvYWRpbmcsCiAgICAgICAgYXBwQ29udGVudDogZWxlbWVudCA/IGFwcENvbnRlbnQgOiAnJwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgY29udGFpbmVyRWxlbWVudCA9IGdldENvbnRhaW5lcihjb250YWluZXIpOyAvLyBUaGUgY29udGFpbmVyIG1pZ2h0IGhhdmUgYmUgcmVtb3ZlZCBhZnRlciBtaWNybyBhcHAgdW5tb3VudGVkLgogICAgLy8gU3VjaCBhcyB0aGUgbWljcm8gYXBwIHVubW91bnQgbGlmZWN5Y2xlIGNhbGxlZCBieSBhIHJlYWN0IGNvbXBvbmVudFdpbGxVbm1vdW50IGxpZmVjeWNsZSwgYWZ0ZXIgbWljcm8gYXBwIHVubW91bnRlZCwgdGhlIHJlYWN0IGNvbXBvbmVudCBtaWdodCBhbHNvIGJlIHJlbW92ZWQKCiAgICBpZiAocGhhc2UgIT09ICd1bm1vdW50ZWQnKSB7CiAgICAgIHZhciBlcnJvck1zZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzd2l0Y2ggKHBoYXNlKSB7CiAgICAgICAgICBjYXNlICdsb2FkaW5nJzoKICAgICAgICAgIGNhc2UgJ21vdW50aW5nJzoKICAgICAgICAgICAgcmV0dXJuICJUYXJnZXQgY29udGFpbmVyIHdpdGggIi5jb25jYXQoY29udGFpbmVyLCAiIG5vdCBleGlzdGVkIHdoaWxlICIpLmNvbmNhdChhcHBOYW1lLCAiICIpLmNvbmNhdChwaGFzZSwgIiEiKTsKCiAgICAgICAgICBjYXNlICdtb3VudGVkJzoKICAgICAgICAgICAgcmV0dXJuICJUYXJnZXQgY29udGFpbmVyIHdpdGggIi5jb25jYXQoY29udGFpbmVyLCAiIG5vdCBleGlzdGVkIGFmdGVyICIpLmNvbmNhdChhcHBOYW1lLCAiICIpLmNvbmNhdChwaGFzZSwgIiEiKTsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gIlRhcmdldCBjb250YWluZXIgd2l0aCAiLmNvbmNhdChjb250YWluZXIsICIgbm90IGV4aXN0ZWQgd2hpbGUgIikuY29uY2F0KGFwcE5hbWUsICIgcmVuZGVyaW5nISIpOwogICAgICAgIH0KICAgICAgfSgpOwoKICAgICAgYXNzZXJ0RWxlbWVudEV4aXN0KGNvbnRhaW5lckVsZW1lbnQsIGVycm9yTXNnKTsKICAgIH0KCiAgICBpZiAoY29udGFpbmVyRWxlbWVudCAmJiAhY29udGFpbmVyRWxlbWVudC5jb250YWlucyhlbGVtZW50KSkgewogICAgICAvLyBjbGVhciB0aGUgY29udGFpbmVyCiAgICAgIHdoaWxlIChjb250YWluZXJFbGVtZW50LmZpcnN0Q2hpbGQpIHsKICAgICAgICByYXdSZW1vdmVDaGlsZC5jYWxsKGNvbnRhaW5lckVsZW1lbnQsIGNvbnRhaW5lckVsZW1lbnQuZmlyc3RDaGlsZCk7CiAgICAgIH0gLy8gYXBwZW5kIHRoZSBlbGVtZW50IHRvIGNvbnRhaW5lciBpZiBpdCBleGlzdAoKCiAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgcmF3QXBwZW5kQ2hpbGQuY2FsbChjb250YWluZXJFbGVtZW50LCBlbGVtZW50KTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfTsKCiAgcmV0dXJuIHJlbmRlcjsKfQoKZnVuY3Rpb24gZ2V0TGlmZWN5Y2xlc0Zyb21FeHBvcnRzKHNjcmlwdEV4cG9ydHMsIGFwcE5hbWUsIGdsb2JhbCwgZ2xvYmFsTGF0ZXN0U2V0UHJvcCkgewogIGlmICh2YWxpZGF0ZUV4cG9ydExpZmVjeWNsZShzY3JpcHRFeHBvcnRzKSkgewogICAgcmV0dXJuIHNjcmlwdEV4cG9ydHM7CiAgfSAvLyBmYWxsYmFjayB0byBzYW5kYm94IGxhdGVzdCBzZXQgcHJvcGVydHkgaWYgaXQgaGFkCgoKICBpZiAoZ2xvYmFsTGF0ZXN0U2V0UHJvcCkgewogICAgdmFyIGxpZmVjeWNsZXMgPSBnbG9iYWxbZ2xvYmFsTGF0ZXN0U2V0UHJvcF07CgogICAgaWYgKHZhbGlkYXRlRXhwb3J0TGlmZWN5Y2xlKGxpZmVjeWNsZXMpKSB7CiAgICAgIHJldHVybiBsaWZlY3ljbGVzOwogICAgfQogIH0KCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7CiAgICBjb25zb2xlLndhcm4oIltxaWFua3VuXSBsaWZlY3ljbGUgbm90IGZvdW5kIGZyb20gIi5jb25jYXQoYXBwTmFtZSwgIiBlbnRyeSBleHBvcnRzLCBmYWxsYmFjayB0byBnZXQgZnJvbSB3aW5kb3dbJyIpLmNvbmNhdChhcHBOYW1lLCAiJ10iKSk7CiAgfSAvLyBmYWxsYmFjayB0byBnbG9iYWwgdmFyaWFibGUgd2hvIG5hbWVkIHdpdGggJHthcHBOYW1lfSB3aGlsZSBtb2R1bGUgZXhwb3J0cyBub3QgZm91bmQKCgogIHZhciBnbG9iYWxWYXJpYWJsZUV4cG9ydHMgPSBnbG9iYWxbYXBwTmFtZV07CgogIGlmICh2YWxpZGF0ZUV4cG9ydExpZmVjeWNsZShnbG9iYWxWYXJpYWJsZUV4cG9ydHMpKSB7CiAgICByZXR1cm4gZ2xvYmFsVmFyaWFibGVFeHBvcnRzOwogIH0KCiAgdGhyb3cgbmV3IFFpYW5rdW5FcnJvcigiWW91IG5lZWQgdG8gZXhwb3J0IGxpZmVjeWNsZSBmdW5jdGlvbnMgaW4gIi5jb25jYXQoYXBwTmFtZSwgIiBlbnRyeSIpKTsKfQoKdmFyIHByZXZBcHBVbm1vdW50ZWREZWZlcnJlZDsKZXhwb3J0IGZ1bmN0aW9uIGxvYWRBcHAoYXBwKSB7CiAgdmFyIGNvbmZpZ3VyYXRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogIHZhciBsaWZlQ3ljbGVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CgogIHZhciBfYTsKCiAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTcoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHZhciBlbnRyeSwgYXBwTmFtZSwgYXBwSW5zdGFuY2VJZCwgbWFya05hbWUsIF9jb25maWd1cmF0aW9uJHNpbmd1bCwgc2luZ3VsYXIsIF9jb25maWd1cmF0aW9uJHNhbmRibywgc2FuZGJveCwgZXhjbHVkZUFzc2V0RmlsdGVyLCBfY29uZmlndXJhdGlvbiRnbG9iYWwsIGdsb2JhbENvbnRleHQsIGltcG9ydEVudHJ5T3B0cywgX3lpZWxkJGltcG9ydEVudHJ5LCB0ZW1wbGF0ZSwgZXhlY1NjcmlwdHMsIGFzc2V0UHVibGljUGF0aCwgYXBwQ29udGVudCwgc3RyaWN0U3R5bGVJc29sYXRpb24sIHNjb3BlZENTUywgaW5pdGlhbEFwcFdyYXBwZXJFbGVtZW50LCBpbml0aWFsQ29udGFpbmVyLCBsZWdhY3lSZW5kZXIsIHJlbmRlciwgaW5pdGlhbEFwcFdyYXBwZXJHZXR0ZXIsIGdsb2JhbCwgbW91bnRTYW5kYm94LCB1bm1vdW50U2FuZGJveCwgdXNlTG9vc2VTYW5kYm94LCBzYW5kYm94Q29udGFpbmVyLCBfbWVyZ2VXaXRoLCBfbWVyZ2VXaXRoJGJlZm9yZVVubW8sIGJlZm9yZVVubW91bnQsIF9tZXJnZVdpdGgkYWZ0ZXJVbm1vdSwgYWZ0ZXJVbm1vdW50LCBfbWVyZ2VXaXRoJGFmdGVyTW91bnQsIGFmdGVyTW91bnQsIF9tZXJnZVdpdGgkYmVmb3JlTW91biwgYmVmb3JlTW91bnQsIF9tZXJnZVdpdGgkYmVmb3JlTG9hZCwgYmVmb3JlTG9hZCwgc2NyaXB0RXhwb3J0cywgX2dldExpZmVjeWNsZXNGcm9tRXhwLCBib290c3RyYXAsIG1vdW50LCB1bm1vdW50LCB1cGRhdGUsIF9nZXRNaWNyb0FwcFN0YXRlQWN0aSwgb25HbG9iYWxTdGF0ZUNoYW5nZSwgc2V0R2xvYmFsU3RhdGUsIG9mZkdsb2JhbFN0YXRlQ2hhbmdlLCBzeW5jQXBwV3JhcHBlckVsZW1lbnQyU2FuZGJveCwgcGFyY2VsQ29uZmlnR2V0dGVyOwoKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE3JChfY29udGV4dDE3KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDE3LnByZXYgPSBfY29udGV4dDE3Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZW50cnkgPSBhcHAuZW50cnksIGFwcE5hbWUgPSBhcHAubmFtZTsKICAgICAgICAgICAgYXBwSW5zdGFuY2VJZCA9ICIiLmNvbmNhdChhcHBOYW1lLCAiXyIpLmNvbmNhdCgrbmV3IERhdGUoKSwgIl8iKS5jb25jYXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCkpOwogICAgICAgICAgICBtYXJrTmFtZSA9ICJbcWlhbmt1bl0gQXBwICIuY29uY2F0KGFwcEluc3RhbmNlSWQsICIgTG9hZGluZyIpOwoKICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7CiAgICAgICAgICAgICAgcGVyZm9ybWFuY2VNYXJrKG1hcmtOYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbmZpZ3VyYXRpb24kc2luZ3VsID0gY29uZmlndXJhdGlvbi5zaW5ndWxhciwgc2luZ3VsYXIgPSBfY29uZmlndXJhdGlvbiRzaW5ndWwgPT09IHZvaWQgMCA/IGZhbHNlIDogX2NvbmZpZ3VyYXRpb24kc2luZ3VsLCBfY29uZmlndXJhdGlvbiRzYW5kYm8gPSBjb25maWd1cmF0aW9uLnNhbmRib3gsIHNhbmRib3ggPSBfY29uZmlndXJhdGlvbiRzYW5kYm8gPT09IHZvaWQgMCA/IHRydWUgOiBfY29uZmlndXJhdGlvbiRzYW5kYm8sIGV4Y2x1ZGVBc3NldEZpbHRlciA9IGNvbmZpZ3VyYXRpb24uZXhjbHVkZUFzc2V0RmlsdGVyLCBfY29uZmlndXJhdGlvbiRnbG9iYWwgPSBjb25maWd1cmF0aW9uLmdsb2JhbENvbnRleHQsIGdsb2JhbENvbnRleHQgPSBfY29uZmlndXJhdGlvbiRnbG9iYWwgPT09IHZvaWQgMCA/IHdpbmRvdyA6IF9jb25maWd1cmF0aW9uJGdsb2JhbCwgaW1wb3J0RW50cnlPcHRzID0gX19yZXN0KGNvbmZpZ3VyYXRpb24sIFsic2luZ3VsYXIiLCAic2FuZGJveCIsICJleGNsdWRlQXNzZXRGaWx0ZXIiLCAiZ2xvYmFsQ29udGV4dCJdKTsgLy8gZ2V0IHRoZSBlbnRyeSBodG1sIGNvbnRlbnQgYW5kIHNjcmlwdCBleGVjdXRvcgoKICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gNzsKICAgICAgICAgICAgcmV0dXJuIGltcG9ydEVudHJ5KGVudHJ5LCBpbXBvcnRFbnRyeU9wdHMpOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgX3lpZWxkJGltcG9ydEVudHJ5ID0gX2NvbnRleHQxNy5zZW50OwogICAgICAgICAgICB0ZW1wbGF0ZSA9IF95aWVsZCRpbXBvcnRFbnRyeS50ZW1wbGF0ZTsKICAgICAgICAgICAgZXhlY1NjcmlwdHMgPSBfeWllbGQkaW1wb3J0RW50cnkuZXhlY1NjcmlwdHM7CiAgICAgICAgICAgIGFzc2V0UHVibGljUGF0aCA9IF95aWVsZCRpbXBvcnRFbnRyeS5hc3NldFB1YmxpY1BhdGg7CiAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDEzOwogICAgICAgICAgICByZXR1cm4gdmFsaWRhdGVTaW5ndWxhck1vZGUoc2luZ3VsYXIsIGFwcCk7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgaWYgKCFfY29udGV4dDE3LnNlbnQpIHsKICAgICAgICAgICAgICBfY29udGV4dDE3Lm5leHQgPSAxNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gMTY7CiAgICAgICAgICAgIHJldHVybiBwcmV2QXBwVW5tb3VudGVkRGVmZXJyZWQgJiYgcHJldkFwcFVubW91bnRlZERlZmVycmVkLnByb21pc2U7CgogICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgYXBwQ29udGVudCA9IGdldERlZmF1bHRUcGxXcmFwcGVyKGFwcEluc3RhbmNlSWQsIGFwcE5hbWUpKHRlbXBsYXRlKTsKICAgICAgICAgICAgc3RyaWN0U3R5bGVJc29sYXRpb24gPSBfdHlwZW9mKHNhbmRib3gpID09PSAnb2JqZWN0JyAmJiAhIXNhbmRib3guc3RyaWN0U3R5bGVJc29sYXRpb247CiAgICAgICAgICAgIHNjb3BlZENTUyA9IGlzRW5hYmxlU2NvcGVkQ1NTKHNhbmRib3gpOwogICAgICAgICAgICBpbml0aWFsQXBwV3JhcHBlckVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KGFwcENvbnRlbnQsIHN0cmljdFN0eWxlSXNvbGF0aW9uLCBzY29wZWRDU1MsIGFwcE5hbWUpOwogICAgICAgICAgICBpbml0aWFsQ29udGFpbmVyID0gJ2NvbnRhaW5lcicgaW4gYXBwID8gYXBwLmNvbnRhaW5lciA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgbGVnYWN5UmVuZGVyID0gJ3JlbmRlcicgaW4gYXBwID8gYXBwLnJlbmRlciA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgcmVuZGVyID0gZ2V0UmVuZGVyKGFwcE5hbWUsIGFwcENvbnRlbnQsIGxlZ2FjeVJlbmRlcik7IC8vIOesrOS4gOasoeWKoOi9veiuvue9ruW6lOeUqOWPr+ingeWMuuWfnyBkb20g57uT5p6ECiAgICAgICAgICAgIC8vIOehruS/neavj+asoeW6lOeUqOWKoOi9veWJjeWuueWZqCBkb20g57uT5p6E5bey57uP6K6+572u5a6M5q+VCgogICAgICAgICAgICByZW5kZXIoewogICAgICAgICAgICAgIGVsZW1lbnQ6IGluaXRpYWxBcHBXcmFwcGVyRWxlbWVudCwKICAgICAgICAgICAgICBsb2FkaW5nOiB0cnVlLAogICAgICAgICAgICAgIGNvbnRhaW5lcjogaW5pdGlhbENvbnRhaW5lcgogICAgICAgICAgICB9LCAnbG9hZGluZycpOwogICAgICAgICAgICBpbml0aWFsQXBwV3JhcHBlckdldHRlciA9IGdldEFwcFdyYXBwZXJHZXR0ZXIoYXBwTmFtZSwgYXBwSW5zdGFuY2VJZCwgISFsZWdhY3lSZW5kZXIsIHN0cmljdFN0eWxlSXNvbGF0aW9uLCBzY29wZWRDU1MsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gaW5pdGlhbEFwcFdyYXBwZXJFbGVtZW50OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZ2xvYmFsID0gZ2xvYmFsQ29udGV4dDsKCiAgICAgICAgICAgIG1vdW50U2FuZGJveCA9IGZ1bmN0aW9uIG1vdW50U2FuZGJveCgpIHsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB1bm1vdW50U2FuZGJveCA9IGZ1bmN0aW9uIHVubW91bnRTYW5kYm94KCkgewogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHVzZUxvb3NlU2FuZGJveCA9IF90eXBlb2Yoc2FuZGJveCkgPT09ICdvYmplY3QnICYmICEhc2FuZGJveC5sb29zZTsKCiAgICAgICAgICAgIGlmIChzYW5kYm94KSB7CiAgICAgICAgICAgICAgc2FuZGJveENvbnRhaW5lciA9IGNyZWF0ZVNhbmRib3hDb250YWluZXIoYXBwTmFtZSwgLy8gRklYTUUgc2hvdWxkIHVzZSBhIHN0cmljdCBzYW5kYm94IGxvZ2ljIHdoaWxlIHJlbW91bnQsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vdW1panMvcWlhbmt1bi9pc3N1ZXMvNTE4CiAgICAgICAgICAgICAgaW5pdGlhbEFwcFdyYXBwZXJHZXR0ZXIsIHNjb3BlZENTUywgdXNlTG9vc2VTYW5kYm94LCBleGNsdWRlQXNzZXRGaWx0ZXIsIGdsb2JhbCk7IC8vIOeUqOaymeeuseeahOS7o+eQhuWvueixoeS9nOS4uuaOpeS4i+adpeS9v+eUqOeahOWFqOWxgOWvueixoQoKICAgICAgICAgICAgICBnbG9iYWwgPSBzYW5kYm94Q29udGFpbmVyLmluc3RhbmNlLnByb3h5OwogICAgICAgICAgICAgIG1vdW50U2FuZGJveCA9IHNhbmRib3hDb250YWluZXIubW91bnQ7CiAgICAgICAgICAgICAgdW5tb3VudFNhbmRib3ggPSBzYW5kYm94Q29udGFpbmVyLnVubW91bnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9tZXJnZVdpdGggPSBfbWVyZ2VXaXRoMih7fSwgZ2V0QWRkT25zKGdsb2JhbCwgYXNzZXRQdWJsaWNQYXRoKSwgbGlmZUN5Y2xlcywgZnVuY3Rpb24gKHYxLCB2MikgewogICAgICAgICAgICAgIHJldHVybiBfY29uY2F0KHYxICE9PSBudWxsICYmIHYxICE9PSB2b2lkIDAgPyB2MSA6IFtdLCB2MiAhPT0gbnVsbCAmJiB2MiAhPT0gdm9pZCAwID8gdjIgOiBbXSk7CiAgICAgICAgICAgIH0pLCBfbWVyZ2VXaXRoJGJlZm9yZVVubW8gPSBfbWVyZ2VXaXRoLmJlZm9yZVVubW91bnQsIGJlZm9yZVVubW91bnQgPSBfbWVyZ2VXaXRoJGJlZm9yZVVubW8gPT09IHZvaWQgMCA/IFtdIDogX21lcmdlV2l0aCRiZWZvcmVVbm1vLCBfbWVyZ2VXaXRoJGFmdGVyVW5tb3UgPSBfbWVyZ2VXaXRoLmFmdGVyVW5tb3VudCwgYWZ0ZXJVbm1vdW50ID0gX21lcmdlV2l0aCRhZnRlclVubW91ID09PSB2b2lkIDAgPyBbXSA6IF9tZXJnZVdpdGgkYWZ0ZXJVbm1vdSwgX21lcmdlV2l0aCRhZnRlck1vdW50ID0gX21lcmdlV2l0aC5hZnRlck1vdW50LCBhZnRlck1vdW50ID0gX21lcmdlV2l0aCRhZnRlck1vdW50ID09PSB2b2lkIDAgPyBbXSA6IF9tZXJnZVdpdGgkYWZ0ZXJNb3VudCwgX21lcmdlV2l0aCRiZWZvcmVNb3VuID0gX21lcmdlV2l0aC5iZWZvcmVNb3VudCwgYmVmb3JlTW91bnQgPSBfbWVyZ2VXaXRoJGJlZm9yZU1vdW4gPT09IHZvaWQgMCA/IFtdIDogX21lcmdlV2l0aCRiZWZvcmVNb3VuLCBfbWVyZ2VXaXRoJGJlZm9yZUxvYWQgPSBfbWVyZ2VXaXRoLmJlZm9yZUxvYWQsIGJlZm9yZUxvYWQgPSBfbWVyZ2VXaXRoJGJlZm9yZUxvYWQgPT09IHZvaWQgMCA/IFtdIDogX21lcmdlV2l0aCRiZWZvcmVMb2FkOwogICAgICAgICAgICBfY29udGV4dDE3Lm5leHQgPSAzMzsKICAgICAgICAgICAgcmV0dXJuIGV4ZWNIb29rc0NoYWluKHRvQXJyYXkoYmVmb3JlTG9hZCksIGFwcCwgZ2xvYmFsKTsKCiAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICBfY29udGV4dDE3Lm5leHQgPSAzNTsKICAgICAgICAgICAgcmV0dXJuIGV4ZWNTY3JpcHRzKGdsb2JhbCwgc2FuZGJveCAmJiAhdXNlTG9vc2VTYW5kYm94KTsKCiAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICBzY3JpcHRFeHBvcnRzID0gX2NvbnRleHQxNy5zZW50OwogICAgICAgICAgICBfZ2V0TGlmZWN5Y2xlc0Zyb21FeHAgPSBnZXRMaWZlY3ljbGVzRnJvbUV4cG9ydHMoc2NyaXB0RXhwb3J0cywgYXBwTmFtZSwgZ2xvYmFsLCAoX2EgPSBzYW5kYm94Q29udGFpbmVyID09PSBudWxsIHx8IHNhbmRib3hDb250YWluZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNhbmRib3hDb250YWluZXIuaW5zdGFuY2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sYXRlc3RTZXRQcm9wKSwgYm9vdHN0cmFwID0gX2dldExpZmVjeWNsZXNGcm9tRXhwLmJvb3RzdHJhcCwgbW91bnQgPSBfZ2V0TGlmZWN5Y2xlc0Zyb21FeHAubW91bnQsIHVubW91bnQgPSBfZ2V0TGlmZWN5Y2xlc0Zyb21FeHAudW5tb3VudCwgdXBkYXRlID0gX2dldExpZmVjeWNsZXNGcm9tRXhwLnVwZGF0ZTsKICAgICAgICAgICAgX2dldE1pY3JvQXBwU3RhdGVBY3RpID0gZ2V0TWljcm9BcHBTdGF0ZUFjdGlvbnMoYXBwSW5zdGFuY2VJZCksIG9uR2xvYmFsU3RhdGVDaGFuZ2UgPSBfZ2V0TWljcm9BcHBTdGF0ZUFjdGkub25HbG9iYWxTdGF0ZUNoYW5nZSwgc2V0R2xvYmFsU3RhdGUgPSBfZ2V0TWljcm9BcHBTdGF0ZUFjdGkuc2V0R2xvYmFsU3RhdGUsIG9mZkdsb2JhbFN0YXRlQ2hhbmdlID0gX2dldE1pY3JvQXBwU3RhdGVBY3RpLm9mZkdsb2JhbFN0YXRlQ2hhbmdlOyAvLyBGSVhNRSB0ZW1wb3Jhcnkgd2F5CgogICAgICAgICAgICBzeW5jQXBwV3JhcHBlckVsZW1lbnQyU2FuZGJveCA9IGZ1bmN0aW9uIHN5bmNBcHBXcmFwcGVyRWxlbWVudDJTYW5kYm94KGVsZW1lbnQpIHsKICAgICAgICAgICAgICByZXR1cm4gaW5pdGlhbEFwcFdyYXBwZXJFbGVtZW50ID0gZWxlbWVudDsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHBhcmNlbENvbmZpZ0dldHRlciA9IGZ1bmN0aW9uIHBhcmNlbENvbmZpZ0dldHRlcigpIHsKICAgICAgICAgICAgICB2YXIgcmVtb3VudENvbnRhaW5lciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogaW5pdGlhbENvbnRhaW5lcjsKICAgICAgICAgICAgICB2YXIgYXBwV3JhcHBlckVsZW1lbnQ7CiAgICAgICAgICAgICAgdmFyIGFwcFdyYXBwZXJHZXR0ZXI7CiAgICAgICAgICAgICAgdmFyIHBhcmNlbENvbmZpZyA9IHsKICAgICAgICAgICAgICAgIG5hbWU6IGFwcEluc3RhbmNlSWQsCiAgICAgICAgICAgICAgICBib290c3RyYXA6IGJvb3RzdHJhcCwKICAgICAgICAgICAgICAgIG1vdW50OiBbZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbWFya3M7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya3MgPSBwZXJmb3JtYW5jZUdldEVudHJpZXNCeU5hbWUobWFya05hbWUsICdtYXJrJyk7IC8vIG1hcmsgbGVuZ3RoIGlzIHplcm8gbWVhbnMgdGhlIGFwcCBpcyByZW1vdW50aW5nCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFya3MgJiYgIW1hcmtzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmZvcm1hbmNlTWFyayhtYXJrTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZVNpbmd1bGFyTW9kZShzaW5ndWxhciwgYXBwKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDMudDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBwcmV2QXBwVW5tb3VudGVkRGVmZXJyZWQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQzLnQwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHByZXZBcHBVbm1vdW50ZWREZWZlcnJlZC5wcm9taXNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0sIC8vIGluaXRpYWwgd3JhcHBlciBlbGVtZW50IGJlZm9yZSBhcHAgbW91bnQvcmVtb3VudAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFdyYXBwZXJFbGVtZW50ID0gaW5pdGlhbEFwcFdyYXBwZXJFbGVtZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwV3JhcHBlckdldHRlciA9IGdldEFwcFdyYXBwZXJHZXR0ZXIoYXBwTmFtZSwgYXBwSW5zdGFuY2VJZCwgISFsZWdhY3lSZW5kZXIsIHN0cmljdFN0eWxlSXNvbGF0aW9uLCBzY29wZWRDU1MsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcFdyYXBwZXJFbGVtZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0sIC8vIOa3u+WKoCBtb3VudCBob29rLCDnoa7kv53mr4/mrKHlupTnlKjliqDovb3liY3lrrnlmaggZG9tIOe7k+aehOW3sue7j+iuvue9ruWujOavlQogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdXNlTmV3Q29udGFpbmVyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlTmV3Q29udGFpbmVyID0gcmVtb3VudENvbnRhaW5lciAhPT0gaW5pdGlhbENvbnRhaW5lcjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlTmV3Q29udGFpbmVyIHx8ICFhcHBXcmFwcGVyRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50IHdpbGwgYmUgZGVzdHJveWVkIGFmdGVyIHVubW91bnRlZCwgd2UgbmVlZCB0byByZWNyZWF0ZSBpdCBpZiBpdCBub3QgZXhpc3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3Igd2UgdHJ5IHRvIHJlbW91bnQgaW50byBhIG5ldyBjb250YWluZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwV3JhcHBlckVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KGFwcENvbnRlbnQsIHN0cmljdFN0eWxlSXNvbGF0aW9uLCBzY29wZWRDU1MsIGFwcE5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW5jQXBwV3JhcHBlckVsZW1lbnQyU2FuZGJveChhcHBXcmFwcGVyRWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogYXBwV3JhcHBlckVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogcmVtb3VudENvbnRhaW5lcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgJ21vdW50aW5nJyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0sIG1vdW50U2FuZGJveCwgLy8gZXhlYyB0aGUgY2hhaW4gYWZ0ZXIgcmVuZGVyaW5nIHRvIGtlZXAgdGhlIGJlaGF2aW9yIHdpdGggYmVmb3JlTG9hZAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCBleGVjSG9va3NDaGFpbih0b0FycmF5KGJlZm9yZU1vdW50KSwgYXBwLCBnbG9iYWwpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU2KTsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHByb3BzKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIG1vdW50KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcHJvcHMpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogYXBwV3JhcHBlckdldHRlcigpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRHbG9iYWxTdGF0ZTogc2V0R2xvYmFsU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uR2xvYmFsU3RhdGVDaGFuZ2U6IG9uR2xvYmFsU3RhdGVDaGFuZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNyk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0sIC8vIGZpbmlzaCBsb2FkaW5nIGFmdGVyIGFwcCBtb3VudGVkCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHJlbmRlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGFwcFdyYXBwZXJFbGVtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiByZW1vdW50Q29udGFpbmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAnbW91bnRlZCcpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU4KTsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCBleGVjSG9va3NDaGFpbih0b0FycmF5KGFmdGVyTW91bnQpLCBhcHAsIGdsb2JhbCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTkpOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9LCAvLyBpbml0aWFsaXplIHRoZSB1bm1vdW50IGRlZmVyIGFmdGVyIGFwcCBtb3VudGVkIGFuZCByZXNvbHZlIHRoZSBkZWZlciBhZnRlciBpdCB1bm1vdW50ZWQKICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGVTaW5ndWxhck1vZGUoc2luZ3VsYXIsIGFwcCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQxMC5zZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZBcHBVbm1vdW50ZWREZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUxMCk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBtZWFzdXJlTmFtZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVhc3VyZU5hbWUgPSAiW3FpYW5rdW5dIEFwcCAiLmNvbmNhdChhcHBJbnN0YW5jZUlkLCAiIExvYWRpbmcgQ29uc3VtaW5nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmZvcm1hbmNlTWVhc3VyZShtZWFzdXJlTmFtZSwgbWFya05hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUxMSk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgdW5tb3VudDogW2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwgZXhlY0hvb2tzQ2hhaW4odG9BcnJheShiZWZvcmVVbm1vdW50KSwgYXBwLCBnbG9iYWwpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMTIpOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocHJvcHMpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEzKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgdW5tb3VudChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHByb3BzKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IGFwcFdyYXBwZXJHZXR0ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMTMpOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9LCB1bm1vdW50U2FuZGJveCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTQkKF9jb250ZXh0MTQpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNC5wcmV2ID0gX2NvbnRleHQxNC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuYWJydXB0KCJyZXR1cm4iLCBleGVjSG9va3NDaGFpbih0b0FycmF5KGFmdGVyVW5tb3VudCksIGFwcCwgZ2xvYmFsKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTE0KTsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTUoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTUpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogcmVtb3VudENvbnRhaW5lcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgJ3VubW91bnRlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2ZmR2xvYmFsU3RhdGVDaGFuZ2UoYXBwSW5zdGFuY2VJZCk7IC8vIGZvciBnYwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFdyYXBwZXJFbGVtZW50ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNBcHBXcmFwcGVyRWxlbWVudDJTYW5kYm94KGFwcFdyYXBwZXJFbGVtZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMTUpOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNikgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRlU2luZ3VsYXJNb2RlKHNpbmd1bGFyLCBhcHApOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE2LnQwID0gX2NvbnRleHQxNi5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQxNi50MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE2LnQwID0gcHJldkFwcFVubW91bnRlZERlZmVycmVkOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV9jb250ZXh0MTYudDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldkFwcFVubW91bnRlZERlZmVycmVkLnJlc29sdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMTYpOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgdXBkYXRlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICBwYXJjZWxDb25maWcudXBkYXRlID0gdXBkYXRlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHBhcmNlbENvbmZpZzsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgcGFyY2VsQ29uZmlnR2V0dGVyKTsKCiAgICAgICAgICBjYXNlIDQxOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTE3KTsKICB9KSk7Cn0="},{"version":3,"sources":["D:/qiankun微前台/Demo/qiankun/qiankun-base/node_modules/qiankun/es/loader.js"],"names":["_concat","_mergeWith2","_typeof","_forEach","_regeneratorRuntime","__awaiter","__rest","importEntry","getAddOns","QiankunError","getMicroAppStateActions","createSandboxContainer","css","Deferred","getContainer","getDefaultTplWrapper","getWrapperId","isEnableScopedCSS","performanceMark","performanceMeasure","performanceGetEntriesByName","toArray","validateExportLifecycle","assertElementExist","element","msg","execHooksChain","hooks","app","global","arguments","length","undefined","window","reduce","chain","hook","then","Promise","resolve","validateSingularMode","validate","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","stop","supportShadowDOM","document","head","attachShadow","createShadowRoot","createElement","appContent","strictStyleIsolation","scopedCSS","appName","containerElement","innerHTML","appElement","firstChild","console","warn","shadow","mode","attr","getAttribute","QiankunCSSRewriteAttr","setAttribute","styleNodes","querySelectorAll","stylesheetElement","process","getAppWrapperGetter","appInstanceId","useLegacyRender","elementGetter","appWrapper","getElementById","concat","shadowRoot","rawAppendChild","HTMLElement","prototype","appendChild","rawRemoveChild","removeChild","getRender","legacyRender","render","_ref","phase","loading","container","env","NODE_ENV","errorMsg","contains","call","getLifecyclesFromExports","scriptExports","globalLatestSetProp","lifecycles","globalVariableExports","prevAppUnmountedDeferred","loadApp","configuration","lifeCycles","_a","_callee17","_this","entry","markName","_configuration$singul","singular","_configuration$sandbo","sandbox","excludeAssetFilter","_configuration$global","globalContext","importEntryOpts","_yield$importEntry","template","execScripts","assetPublicPath","initialAppWrapperElement","initialContainer","initialAppWrapperGetter","mountSandbox","unmountSandbox","useLooseSandbox","sandboxContainer","_mergeWith","_mergeWith$beforeUnmo","beforeUnmount","_mergeWith$afterUnmou","afterUnmount","_mergeWith$afterMount","afterMount","_mergeWith$beforeMoun","beforeMount","_mergeWith$beforeLoad","beforeLoad","_getLifecyclesFromExp","bootstrap","mount","unmount","update","_getMicroAppStateActi","onGlobalStateChange","setGlobalState","offGlobalStateChange","syncAppWrapperElement2Sandbox","parcelConfigGetter","_callee17$","_context17","name","Date","Math","floor","random","sent","promise","loose","instance","proxy","v1","v2","latestSetProp","remountContainer","appWrapperElement","appWrapperGetter","parcelConfig","_callee2","marks","_callee2$","_context2","_callee3","_callee3$","_context3","t0","_callee4","_callee4$","_context4","_callee5","useNewContainer","_callee5$","_context5","_callee6","_callee6$","_context6","props","_callee7","_callee7$","_context7","Object","assign","_callee8","_callee8$","_context8","_callee9","_callee9$","_context9","_callee10","_callee10$","_context10","_callee11","measureName","_callee11$","_context11","_callee12","_callee12$","_context12","_callee13","_callee13$","_context13","_callee14","_callee14$","_context14","_callee15","_callee15$","_context15","_callee16","_callee16$","_context16"],"mappings":"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","sourcesContent":["import _concat from \"lodash/concat\";\nimport _mergeWith2 from \"lodash/mergeWith\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _forEach from \"lodash/forEach\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\n/**\n * @author Kuitos\n * @since 2020-04-01\n */\nimport { __awaiter, __rest } from \"tslib\";\nimport { importEntry } from 'import-html-entry';\nimport getAddOns from './addons';\nimport { QiankunError } from './error';\nimport { getMicroAppStateActions } from './globalState';\nimport { createSandboxContainer, css } from './sandbox';\nimport { Deferred, getContainer, getDefaultTplWrapper, getWrapperId, isEnableScopedCSS, performanceMark, performanceMeasure, performanceGetEntriesByName, toArray, validateExportLifecycle } from './utils';\n\nfunction assertElementExist(element, msg) {\n  if (!element) {\n    if (msg) {\n      throw new QiankunError(msg);\n    }\n\n    throw new QiankunError('element not existed!');\n  }\n}\n\nfunction execHooksChain(hooks, app) {\n  var global = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : window;\n\n  if (hooks.length) {\n    return hooks.reduce(function (chain, hook) {\n      return chain.then(function () {\n        return hook(app, global);\n      });\n    }, Promise.resolve());\n  }\n\n  return Promise.resolve();\n}\n\nfunction validateSingularMode(validate, app) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", typeof validate === 'function' ? validate(app) : !!validate);\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n} // @ts-ignore\n\n\nvar supportShadowDOM = document.head.attachShadow || document.head.createShadowRoot;\n\nfunction createElement(appContent, strictStyleIsolation, scopedCSS, appName) {\n  var containerElement = document.createElement('div');\n  containerElement.innerHTML = appContent; // appContent always wrapped with a singular div\n\n  var appElement = containerElement.firstChild;\n\n  if (strictStyleIsolation) {\n    if (!supportShadowDOM) {\n      console.warn('[qiankun]: As current browser not support shadow dom, your strictStyleIsolation configuration will be ignored!');\n    } else {\n      var innerHTML = appElement.innerHTML;\n      appElement.innerHTML = '';\n      var shadow;\n\n      if (appElement.attachShadow) {\n        shadow = appElement.attachShadow({\n          mode: 'open'\n        });\n      } else {\n        // createShadowRoot was proposed in initial spec, which has then been deprecated\n        shadow = appElement.createShadowRoot();\n      }\n\n      shadow.innerHTML = innerHTML;\n    }\n  }\n\n  if (scopedCSS) {\n    var attr = appElement.getAttribute(css.QiankunCSSRewriteAttr);\n\n    if (!attr) {\n      appElement.setAttribute(css.QiankunCSSRewriteAttr, appName);\n    }\n\n    var styleNodes = appElement.querySelectorAll('style') || [];\n\n    _forEach(styleNodes, function (stylesheetElement) {\n      css.process(appElement, stylesheetElement, appName);\n    });\n  }\n\n  return appElement;\n}\n/** generate app wrapper dom getter */\n\n\nfunction getAppWrapperGetter(appName, appInstanceId, useLegacyRender, strictStyleIsolation, scopedCSS, elementGetter) {\n  return function () {\n    if (useLegacyRender) {\n      if (strictStyleIsolation) throw new QiankunError('strictStyleIsolation can not be used with legacy render!');\n      if (scopedCSS) throw new QiankunError('experimentalStyleIsolation can not be used with legacy render!');\n      var appWrapper = document.getElementById(getWrapperId(appInstanceId));\n      assertElementExist(appWrapper, \"Wrapper element for \".concat(appName, \" with instance \").concat(appInstanceId, \" is not existed!\"));\n      return appWrapper;\n    }\n\n    var element = elementGetter();\n    assertElementExist(element, \"Wrapper element for \".concat(appName, \" with instance \").concat(appInstanceId, \" is not existed!\"));\n\n    if (strictStyleIsolation && supportShadowDOM) {\n      return element.shadowRoot;\n    }\n\n    return element;\n  };\n}\n\nvar rawAppendChild = HTMLElement.prototype.appendChild;\nvar rawRemoveChild = HTMLElement.prototype.removeChild;\n/**\n * Get the render function\n * If the legacy render function is provide, used as it, otherwise we will insert the app element to target container by qiankun\n * @param appName\n * @param appContent\n * @param legacyRender\n */\n\nfunction getRender(appName, appContent, legacyRender) {\n  var render = function render(_ref, phase) {\n    var element = _ref.element,\n        loading = _ref.loading,\n        container = _ref.container;\n\n    if (legacyRender) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('[qiankun] Custom rendering function is deprecated, you can use the container element setting instead!');\n      }\n\n      return legacyRender({\n        loading: loading,\n        appContent: element ? appContent : ''\n      });\n    }\n\n    var containerElement = getContainer(container); // The container might have be removed after micro app unmounted.\n    // Such as the micro app unmount lifecycle called by a react componentWillUnmount lifecycle, after micro app unmounted, the react component might also be removed\n\n    if (phase !== 'unmounted') {\n      var errorMsg = function () {\n        switch (phase) {\n          case 'loading':\n          case 'mounting':\n            return \"Target container with \".concat(container, \" not existed while \").concat(appName, \" \").concat(phase, \"!\");\n\n          case 'mounted':\n            return \"Target container with \".concat(container, \" not existed after \").concat(appName, \" \").concat(phase, \"!\");\n\n          default:\n            return \"Target container with \".concat(container, \" not existed while \").concat(appName, \" rendering!\");\n        }\n      }();\n\n      assertElementExist(containerElement, errorMsg);\n    }\n\n    if (containerElement && !containerElement.contains(element)) {\n      // clear the container\n      while (containerElement.firstChild) {\n        rawRemoveChild.call(containerElement, containerElement.firstChild);\n      } // append the element to container if it exist\n\n\n      if (element) {\n        rawAppendChild.call(containerElement, element);\n      }\n    }\n\n    return undefined;\n  };\n\n  return render;\n}\n\nfunction getLifecyclesFromExports(scriptExports, appName, global, globalLatestSetProp) {\n  if (validateExportLifecycle(scriptExports)) {\n    return scriptExports;\n  } // fallback to sandbox latest set property if it had\n\n\n  if (globalLatestSetProp) {\n    var lifecycles = global[globalLatestSetProp];\n\n    if (validateExportLifecycle(lifecycles)) {\n      return lifecycles;\n    }\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    console.warn(\"[qiankun] lifecycle not found from \".concat(appName, \" entry exports, fallback to get from window['\").concat(appName, \"']\"));\n  } // fallback to global variable who named with ${appName} while module exports not found\n\n\n  var globalVariableExports = global[appName];\n\n  if (validateExportLifecycle(globalVariableExports)) {\n    return globalVariableExports;\n  }\n\n  throw new QiankunError(\"You need to export lifecycle functions in \".concat(appName, \" entry\"));\n}\n\nvar prevAppUnmountedDeferred;\nexport function loadApp(app) {\n  var configuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var lifeCycles = arguments.length > 2 ? arguments[2] : undefined;\n\n  var _a;\n\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee17() {\n    var _this = this;\n\n    var entry, appName, appInstanceId, markName, _configuration$singul, singular, _configuration$sandbo, sandbox, excludeAssetFilter, _configuration$global, globalContext, importEntryOpts, _yield$importEntry, template, execScripts, assetPublicPath, appContent, strictStyleIsolation, scopedCSS, initialAppWrapperElement, initialContainer, legacyRender, render, initialAppWrapperGetter, global, mountSandbox, unmountSandbox, useLooseSandbox, sandboxContainer, _mergeWith, _mergeWith$beforeUnmo, beforeUnmount, _mergeWith$afterUnmou, afterUnmount, _mergeWith$afterMount, afterMount, _mergeWith$beforeMoun, beforeMount, _mergeWith$beforeLoad, beforeLoad, scriptExports, _getLifecyclesFromExp, bootstrap, mount, unmount, update, _getMicroAppStateActi, onGlobalStateChange, setGlobalState, offGlobalStateChange, syncAppWrapperElement2Sandbox, parcelConfigGetter;\n\n    return _regeneratorRuntime.wrap(function _callee17$(_context17) {\n      while (1) {\n        switch (_context17.prev = _context17.next) {\n          case 0:\n            entry = app.entry, appName = app.name;\n            appInstanceId = \"\".concat(appName, \"_\").concat(+new Date(), \"_\").concat(Math.floor(Math.random() * 1000));\n            markName = \"[qiankun] App \".concat(appInstanceId, \" Loading\");\n\n            if (process.env.NODE_ENV === 'development') {\n              performanceMark(markName);\n            }\n\n            _configuration$singul = configuration.singular, singular = _configuration$singul === void 0 ? false : _configuration$singul, _configuration$sandbo = configuration.sandbox, sandbox = _configuration$sandbo === void 0 ? true : _configuration$sandbo, excludeAssetFilter = configuration.excludeAssetFilter, _configuration$global = configuration.globalContext, globalContext = _configuration$global === void 0 ? window : _configuration$global, importEntryOpts = __rest(configuration, [\"singular\", \"sandbox\", \"excludeAssetFilter\", \"globalContext\"]); // get the entry html content and script executor\n\n            _context17.next = 7;\n            return importEntry(entry, importEntryOpts);\n\n          case 7:\n            _yield$importEntry = _context17.sent;\n            template = _yield$importEntry.template;\n            execScripts = _yield$importEntry.execScripts;\n            assetPublicPath = _yield$importEntry.assetPublicPath;\n            _context17.next = 13;\n            return validateSingularMode(singular, app);\n\n          case 13:\n            if (!_context17.sent) {\n              _context17.next = 16;\n              break;\n            }\n\n            _context17.next = 16;\n            return prevAppUnmountedDeferred && prevAppUnmountedDeferred.promise;\n\n          case 16:\n            appContent = getDefaultTplWrapper(appInstanceId, appName)(template);\n            strictStyleIsolation = _typeof(sandbox) === 'object' && !!sandbox.strictStyleIsolation;\n            scopedCSS = isEnableScopedCSS(sandbox);\n            initialAppWrapperElement = createElement(appContent, strictStyleIsolation, scopedCSS, appName);\n            initialContainer = 'container' in app ? app.container : undefined;\n            legacyRender = 'render' in app ? app.render : undefined;\n            render = getRender(appName, appContent, legacyRender); // 第一次加载设置应用可见区域 dom 结构\n            // 确保每次应用加载前容器 dom 结构已经设置完毕\n\n            render({\n              element: initialAppWrapperElement,\n              loading: true,\n              container: initialContainer\n            }, 'loading');\n            initialAppWrapperGetter = getAppWrapperGetter(appName, appInstanceId, !!legacyRender, strictStyleIsolation, scopedCSS, function () {\n              return initialAppWrapperElement;\n            });\n            global = globalContext;\n\n            mountSandbox = function mountSandbox() {\n              return Promise.resolve();\n            };\n\n            unmountSandbox = function unmountSandbox() {\n              return Promise.resolve();\n            };\n\n            useLooseSandbox = _typeof(sandbox) === 'object' && !!sandbox.loose;\n\n            if (sandbox) {\n              sandboxContainer = createSandboxContainer(appName, // FIXME should use a strict sandbox logic while remount, see https://github.com/umijs/qiankun/issues/518\n              initialAppWrapperGetter, scopedCSS, useLooseSandbox, excludeAssetFilter, global); // 用沙箱的代理对象作为接下来使用的全局对象\n\n              global = sandboxContainer.instance.proxy;\n              mountSandbox = sandboxContainer.mount;\n              unmountSandbox = sandboxContainer.unmount;\n            }\n\n            _mergeWith = _mergeWith2({}, getAddOns(global, assetPublicPath), lifeCycles, function (v1, v2) {\n              return _concat(v1 !== null && v1 !== void 0 ? v1 : [], v2 !== null && v2 !== void 0 ? v2 : []);\n            }), _mergeWith$beforeUnmo = _mergeWith.beforeUnmount, beforeUnmount = _mergeWith$beforeUnmo === void 0 ? [] : _mergeWith$beforeUnmo, _mergeWith$afterUnmou = _mergeWith.afterUnmount, afterUnmount = _mergeWith$afterUnmou === void 0 ? [] : _mergeWith$afterUnmou, _mergeWith$afterMount = _mergeWith.afterMount, afterMount = _mergeWith$afterMount === void 0 ? [] : _mergeWith$afterMount, _mergeWith$beforeMoun = _mergeWith.beforeMount, beforeMount = _mergeWith$beforeMoun === void 0 ? [] : _mergeWith$beforeMoun, _mergeWith$beforeLoad = _mergeWith.beforeLoad, beforeLoad = _mergeWith$beforeLoad === void 0 ? [] : _mergeWith$beforeLoad;\n            _context17.next = 33;\n            return execHooksChain(toArray(beforeLoad), app, global);\n\n          case 33:\n            _context17.next = 35;\n            return execScripts(global, sandbox && !useLooseSandbox);\n\n          case 35:\n            scriptExports = _context17.sent;\n            _getLifecyclesFromExp = getLifecyclesFromExports(scriptExports, appName, global, (_a = sandboxContainer === null || sandboxContainer === void 0 ? void 0 : sandboxContainer.instance) === null || _a === void 0 ? void 0 : _a.latestSetProp), bootstrap = _getLifecyclesFromExp.bootstrap, mount = _getLifecyclesFromExp.mount, unmount = _getLifecyclesFromExp.unmount, update = _getLifecyclesFromExp.update;\n            _getMicroAppStateActi = getMicroAppStateActions(appInstanceId), onGlobalStateChange = _getMicroAppStateActi.onGlobalStateChange, setGlobalState = _getMicroAppStateActi.setGlobalState, offGlobalStateChange = _getMicroAppStateActi.offGlobalStateChange; // FIXME temporary way\n\n            syncAppWrapperElement2Sandbox = function syncAppWrapperElement2Sandbox(element) {\n              return initialAppWrapperElement = element;\n            };\n\n            parcelConfigGetter = function parcelConfigGetter() {\n              var remountContainer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialContainer;\n              var appWrapperElement;\n              var appWrapperGetter;\n              var parcelConfig = {\n                name: appInstanceId,\n                bootstrap: bootstrap,\n                mount: [function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                    var marks;\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            if (process.env.NODE_ENV === 'development') {\n                              marks = performanceGetEntriesByName(markName, 'mark'); // mark length is zero means the app is remounting\n\n                              if (marks && !marks.length) {\n                                performanceMark(markName);\n                              }\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                      while (1) {\n                        switch (_context3.prev = _context3.next) {\n                          case 0:\n                            _context3.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            _context3.t0 = _context3.sent;\n\n                            if (!_context3.t0) {\n                              _context3.next = 5;\n                              break;\n                            }\n\n                            _context3.t0 = prevAppUnmountedDeferred;\n\n                          case 5:\n                            if (!_context3.t0) {\n                              _context3.next = 7;\n                              break;\n                            }\n\n                            return _context3.abrupt(\"return\", prevAppUnmountedDeferred.promise);\n\n                          case 7:\n                            return _context3.abrupt(\"return\", undefined);\n\n                          case 8:\n                          case \"end\":\n                            return _context3.stop();\n                        }\n                      }\n                    }, _callee3);\n                  }));\n                }, // initial wrapper element before app mount/remount\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            appWrapperElement = initialAppWrapperElement;\n                            appWrapperGetter = getAppWrapperGetter(appName, appInstanceId, !!legacyRender, strictStyleIsolation, scopedCSS, function () {\n                              return appWrapperElement;\n                            });\n\n                          case 2:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n                }, // 添加 mount hook, 确保每次应用加载前容器 dom 结构已经设置完毕\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n                    var useNewContainer;\n                    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            useNewContainer = remountContainer !== initialContainer;\n\n                            if (useNewContainer || !appWrapperElement) {\n                              // element will be destroyed after unmounted, we need to recreate it if it not exist\n                              // or we try to remount into a new container\n                              appWrapperElement = createElement(appContent, strictStyleIsolation, scopedCSS, appName);\n                              syncAppWrapperElement2Sandbox(appWrapperElement);\n                            }\n\n                            render({\n                              element: appWrapperElement,\n                              loading: true,\n                              container: remountContainer\n                            }, 'mounting');\n\n                          case 3:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5);\n                  }));\n                }, mountSandbox, // exec the chain after rendering to keep the behavior with beforeLoad\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                      while (1) {\n                        switch (_context6.prev = _context6.next) {\n                          case 0:\n                            return _context6.abrupt(\"return\", execHooksChain(toArray(beforeMount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context6.stop();\n                        }\n                      }\n                    }, _callee6);\n                  }));\n                }, function (props) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n                    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                      while (1) {\n                        switch (_context7.prev = _context7.next) {\n                          case 0:\n                            return _context7.abrupt(\"return\", mount(Object.assign(Object.assign({}, props), {\n                              container: appWrapperGetter(),\n                              setGlobalState: setGlobalState,\n                              onGlobalStateChange: onGlobalStateChange\n                            })));\n\n                          case 1:\n                          case \"end\":\n                            return _context7.stop();\n                        }\n                      }\n                    }, _callee7);\n                  }));\n                }, // finish loading after app mounted\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n                    return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                      while (1) {\n                        switch (_context8.prev = _context8.next) {\n                          case 0:\n                            return _context8.abrupt(\"return\", render({\n                              element: appWrapperElement,\n                              loading: false,\n                              container: remountContainer\n                            }, 'mounted'));\n\n                          case 1:\n                          case \"end\":\n                            return _context8.stop();\n                        }\n                      }\n                    }, _callee8);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n                    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                      while (1) {\n                        switch (_context9.prev = _context9.next) {\n                          case 0:\n                            return _context9.abrupt(\"return\", execHooksChain(toArray(afterMount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context9.stop();\n                        }\n                      }\n                    }, _callee9);\n                  }));\n                }, // initialize the unmount defer after app mounted and resolve the defer after it unmounted\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n                    return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n                      while (1) {\n                        switch (_context10.prev = _context10.next) {\n                          case 0:\n                            _context10.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            if (!_context10.sent) {\n                              _context10.next = 4;\n                              break;\n                            }\n\n                            prevAppUnmountedDeferred = new Deferred();\n\n                          case 4:\n                          case \"end\":\n                            return _context10.stop();\n                        }\n                      }\n                    }, _callee10);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n                    var measureName;\n                    return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n                      while (1) {\n                        switch (_context11.prev = _context11.next) {\n                          case 0:\n                            if (process.env.NODE_ENV === 'development') {\n                              measureName = \"[qiankun] App \".concat(appInstanceId, \" Loading Consuming\");\n                              performanceMeasure(measureName, markName);\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context11.stop();\n                        }\n                      }\n                    }, _callee11);\n                  }));\n                }],\n                unmount: [function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {\n                    return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n                      while (1) {\n                        switch (_context12.prev = _context12.next) {\n                          case 0:\n                            return _context12.abrupt(\"return\", execHooksChain(toArray(beforeUnmount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context12.stop();\n                        }\n                      }\n                    }, _callee12);\n                  }));\n                }, function (props) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee13() {\n                    return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n                      while (1) {\n                        switch (_context13.prev = _context13.next) {\n                          case 0:\n                            return _context13.abrupt(\"return\", unmount(Object.assign(Object.assign({}, props), {\n                              container: appWrapperGetter()\n                            })));\n\n                          case 1:\n                          case \"end\":\n                            return _context13.stop();\n                        }\n                      }\n                    }, _callee13);\n                  }));\n                }, unmountSandbox, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee14() {\n                    return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n                      while (1) {\n                        switch (_context14.prev = _context14.next) {\n                          case 0:\n                            return _context14.abrupt(\"return\", execHooksChain(toArray(afterUnmount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context14.stop();\n                        }\n                      }\n                    }, _callee14);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee15() {\n                    return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n                      while (1) {\n                        switch (_context15.prev = _context15.next) {\n                          case 0:\n                            render({\n                              element: null,\n                              loading: false,\n                              container: remountContainer\n                            }, 'unmounted');\n                            offGlobalStateChange(appInstanceId); // for gc\n\n                            appWrapperElement = null;\n                            syncAppWrapperElement2Sandbox(appWrapperElement);\n\n                          case 4:\n                          case \"end\":\n                            return _context15.stop();\n                        }\n                      }\n                    }, _callee15);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee16() {\n                    return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n                      while (1) {\n                        switch (_context16.prev = _context16.next) {\n                          case 0:\n                            _context16.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            _context16.t0 = _context16.sent;\n\n                            if (!_context16.t0) {\n                              _context16.next = 5;\n                              break;\n                            }\n\n                            _context16.t0 = prevAppUnmountedDeferred;\n\n                          case 5:\n                            if (!_context16.t0) {\n                              _context16.next = 7;\n                              break;\n                            }\n\n                            prevAppUnmountedDeferred.resolve();\n\n                          case 7:\n                          case \"end\":\n                            return _context16.stop();\n                        }\n                      }\n                    }, _callee16);\n                  }));\n                }]\n              };\n\n              if (typeof update === 'function') {\n                parcelConfig.update = update;\n              }\n\n              return parcelConfig;\n            };\n\n            return _context17.abrupt(\"return\", parcelConfigGetter);\n\n          case 41:\n          case \"end\":\n            return _context17.stop();\n        }\n      }\n    }, _callee17);\n  }));\n}"]}]}