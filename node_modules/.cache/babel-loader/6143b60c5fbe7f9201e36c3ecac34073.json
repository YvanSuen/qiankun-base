{"remainingRequest":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js!D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\globalState.js","dependencies":[{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\globalState.js","mtime":1631881155000},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618900774989},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js","mtime":1618886346176}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7CmltcG9ydCBfY2xvbmVEZWVwIGZyb20gImxvZGFzaC9jbG9uZURlZXAiOwp2YXIgZ2xvYmFsU3RhdGUgPSB7fTsKdmFyIGRlcHMgPSB7fTsgLy8g6Kem5Y+R5YWo5bGA55uR5ZCsCgpmdW5jdGlvbiBlbWl0R2xvYmFsKHN0YXRlLCBwcmV2U3RhdGUpIHsKICBPYmplY3Qua2V5cyhkZXBzKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgaWYgKGRlcHNbaWRdIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgZGVwc1tpZF0oX2Nsb25lRGVlcChzdGF0ZSksIF9jbG9uZURlZXAocHJldlN0YXRlKSk7CiAgICB9CiAgfSk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBpbml0R2xvYmFsU3RhdGUoKSB7CiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCiAgaWYgKHN0YXRlID09PSBnbG9iYWxTdGF0ZSkgewogICAgY29uc29sZS53YXJuKCdbcWlhbmt1bl0gc3RhdGUgaGFzIG5vdCBjaGFuZ2Vk77yBJyk7CiAgfSBlbHNlIHsKICAgIHZhciBwcmV2R2xvYmFsU3RhdGUgPSBfY2xvbmVEZWVwKGdsb2JhbFN0YXRlKTsKCiAgICBnbG9iYWxTdGF0ZSA9IF9jbG9uZURlZXAoc3RhdGUpOwogICAgZW1pdEdsb2JhbChnbG9iYWxTdGF0ZSwgcHJldkdsb2JhbFN0YXRlKTsKICB9CgogIHJldHVybiBnZXRNaWNyb0FwcFN0YXRlQWN0aW9ucygiZ2xvYmFsLSIuY29uY2F0KCtuZXcgRGF0ZSgpKSwgdHJ1ZSk7Cn0KZXhwb3J0IGZ1bmN0aW9uIGdldE1pY3JvQXBwU3RhdGVBY3Rpb25zKGlkLCBpc01hc3RlcikgewogIHJldHVybiB7CiAgICAvKioKICAgICAqIG9uR2xvYmFsU3RhdGVDaGFuZ2Ug5YWo5bGA5L6d6LWW55uR5ZCsCiAgICAgKgogICAgICog5pS26ZuGIHNldFN0YXRlIOaXtuaJgOmcgOimgeinpuWPkeeahOS+nei1lgogICAgICoKICAgICAqIOmZkOWItuadoeS7tu+8muavj+S4quWtkOW6lOeUqOWPquacieS4gOS4qua/gOa0u+eKtuaAgeeahOWFqOWxgOebkeWQrO+8jOaWsOebkeWQrOimhuebluaXp+ebkeWQrO+8jOiLpeWPquaYr+ebkeWQrOmDqOWIhuWxnuaAp++8jOivt+S9v+eUqCBvbkdsb2JhbFN0YXRlQ2hhbmdlCiAgICAgKgogICAgICog6L+Z5LmI6K6+6K6h5piv5Li65LqG5YeP5bCR5YWo5bGA55uR5ZCs5rul55So5a+86Ie055qE5YaF5a2Y54iG54K4CiAgICAgKgogICAgICog5L6d6LWW5pWw5o2u57uT5p6E5Li677yaCiAgICAgKiB7CiAgICAgKiAgIHtpZH06IGNhbGxiYWNrCiAgICAgKiB9CiAgICAgKgogICAgICogQHBhcmFtIGNhbGxiYWNrCiAgICAgKiBAcGFyYW0gZmlyZUltbWVkaWF0ZWx5CiAgICAgKi8KICAgIG9uR2xvYmFsU3RhdGVDaGFuZ2U6IGZ1bmN0aW9uIG9uR2xvYmFsU3RhdGVDaGFuZ2UoY2FsbGJhY2ssIGZpcmVJbW1lZGlhdGVseSkgewogICAgICBpZiAoIShjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1txaWFua3VuXSBjYWxsYmFjayBtdXN0IGJlIGZ1bmN0aW9uIScpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGRlcHNbaWRdKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJbcWlhbmt1bl0gJyIuY29uY2F0KGlkLCAiJyBnbG9iYWwgbGlzdGVuZXIgYWxyZWFkeSBleGlzdHMgYmVmb3JlIHRoaXMsIG5ldyBsaXN0ZW5lciB3aWxsIG92ZXJ3cml0ZSBpdC4iKSk7CiAgICAgIH0KCiAgICAgIGRlcHNbaWRdID0gY2FsbGJhY2s7CgogICAgICBpZiAoZmlyZUltbWVkaWF0ZWx5KSB7CiAgICAgICAgdmFyIGNsb25lU3RhdGUgPSBfY2xvbmVEZWVwKGdsb2JhbFN0YXRlKTsKCiAgICAgICAgY2FsbGJhY2soY2xvbmVTdGF0ZSwgY2xvbmVTdGF0ZSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBzZXRHbG9iYWxTdGF0ZSDmm7TmlrAgc3RvcmUg5pWw5o2uCiAgICAgKgogICAgICogMS4g5a+56L6T5YWlIHN0YXRlIOeahOesrOS4gOWxguWxnuaAp+WBmuagoemqjO+8jOWPquacieWIneWni+WMluaXtuWjsOaYjui/h+eahOesrOS4gOWxgu+8iGJ1Y2tldO+8ieWxnuaAp+aJjeS8muiiq+abtOaUuQogICAgICogMi4g5L+u5pS5IHN0b3JlIOW5tuinpuWPkeWFqOWxgOebkeWQrAogICAgICoKICAgICAqIEBwYXJhbSBzdGF0ZQogICAgICovCiAgICBzZXRHbG9iYWxTdGF0ZTogZnVuY3Rpb24gc2V0R2xvYmFsU3RhdGUoKSB7CiAgICAgIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgICBpZiAoc3RhdGUgPT09IGdsb2JhbFN0YXRlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdbcWlhbmt1bl0gc3RhdGUgaGFzIG5vdCBjaGFuZ2Vk77yBJyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgY2hhbmdlS2V5cyA9IFtdOwoKICAgICAgdmFyIHByZXZHbG9iYWxTdGF0ZSA9IF9jbG9uZURlZXAoZ2xvYmFsU3RhdGUpOwoKICAgICAgZ2xvYmFsU3RhdGUgPSBfY2xvbmVEZWVwKE9iamVjdC5rZXlzKHN0YXRlKS5yZWR1Y2UoZnVuY3Rpb24gKF9nbG9iYWxTdGF0ZSwgY2hhbmdlS2V5KSB7CiAgICAgICAgaWYgKGlzTWFzdGVyIHx8IF9nbG9iYWxTdGF0ZS5oYXNPd25Qcm9wZXJ0eShjaGFuZ2VLZXkpKSB7CiAgICAgICAgICBjaGFuZ2VLZXlzLnB1c2goY2hhbmdlS2V5KTsKICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKF9nbG9iYWxTdGF0ZSwgX2RlZmluZVByb3BlcnR5KHt9LCBjaGFuZ2VLZXksIHN0YXRlW2NoYW5nZUtleV0pKTsKICAgICAgICB9CgogICAgICAgIGNvbnNvbGUud2FybigiW3FpYW5rdW5dICciLmNvbmNhdChjaGFuZ2VLZXksICInIG5vdCBkZWNsYXJlZCB3aGVuIGluaXQgc3RhdGVcdUZGMDEiKSk7CiAgICAgICAgcmV0dXJuIF9nbG9iYWxTdGF0ZTsKICAgICAgfSwgZ2xvYmFsU3RhdGUpKTsKCiAgICAgIGlmIChjaGFuZ2VLZXlzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnNvbGUud2FybignW3FpYW5rdW5dIHN0YXRlIGhhcyBub3QgY2hhbmdlZO+8gScpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgZW1pdEdsb2JhbChnbG9iYWxTdGF0ZSwgcHJldkdsb2JhbFN0YXRlKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgLy8g5rOo6ZSA6K+l5bqU55So5LiL55qE5L6d6LWWCiAgICBvZmZHbG9iYWxTdGF0ZUNoYW5nZTogZnVuY3Rpb24gb2ZmR2xvYmFsU3RhdGVDaGFuZ2UoKSB7CiAgICAgIGRlbGV0ZSBkZXBzW2lkXTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfTsKfQ=="},{"version":3,"sources":["D:/qiankun微前台/Demo/qiankun/qiankun-base/node_modules/qiankun/es/globalState.js"],"names":["_defineProperty","_cloneDeep","globalState","deps","emitGlobal","state","prevState","Object","keys","forEach","id","Function","initGlobalState","arguments","length","undefined","console","warn","prevGlobalState","getMicroAppStateActions","concat","Date","isMaster","onGlobalStateChange","callback","fireImmediately","error","cloneState","setGlobalState","changeKeys","reduce","_globalState","changeKey","hasOwnProperty","push","assign","offGlobalStateChange"],"mappings":"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","sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _cloneDeep from \"lodash/cloneDeep\";\nvar globalState = {};\nvar deps = {}; // 触发全局监听\n\nfunction emitGlobal(state, prevState) {\n  Object.keys(deps).forEach(function (id) {\n    if (deps[id] instanceof Function) {\n      deps[id](_cloneDeep(state), _cloneDeep(prevState));\n    }\n  });\n}\n\nexport function initGlobalState() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (state === globalState) {\n    console.warn('[qiankun] state has not changed！');\n  } else {\n    var prevGlobalState = _cloneDeep(globalState);\n\n    globalState = _cloneDeep(state);\n    emitGlobal(globalState, prevGlobalState);\n  }\n\n  return getMicroAppStateActions(\"global-\".concat(+new Date()), true);\n}\nexport function getMicroAppStateActions(id, isMaster) {\n  return {\n    /**\n     * onGlobalStateChange 全局依赖监听\n     *\n     * 收集 setState 时所需要触发的依赖\n     *\n     * 限制条件：每个子应用只有一个激活状态的全局监听，新监听覆盖旧监听，若只是监听部分属性，请使用 onGlobalStateChange\n     *\n     * 这么设计是为了减少全局监听滥用导致的内存爆炸\n     *\n     * 依赖数据结构为：\n     * {\n     *   {id}: callback\n     * }\n     *\n     * @param callback\n     * @param fireImmediately\n     */\n    onGlobalStateChange: function onGlobalStateChange(callback, fireImmediately) {\n      if (!(callback instanceof Function)) {\n        console.error('[qiankun] callback must be function!');\n        return;\n      }\n\n      if (deps[id]) {\n        console.warn(\"[qiankun] '\".concat(id, \"' global listener already exists before this, new listener will overwrite it.\"));\n      }\n\n      deps[id] = callback;\n\n      if (fireImmediately) {\n        var cloneState = _cloneDeep(globalState);\n\n        callback(cloneState, cloneState);\n      }\n    },\n\n    /**\n     * setGlobalState 更新 store 数据\n     *\n     * 1. 对输入 state 的第一层属性做校验，只有初始化时声明过的第一层（bucket）属性才会被更改\n     * 2. 修改 store 并触发全局监听\n     *\n     * @param state\n     */\n    setGlobalState: function setGlobalState() {\n      var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      if (state === globalState) {\n        console.warn('[qiankun] state has not changed！');\n        return false;\n      }\n\n      var changeKeys = [];\n\n      var prevGlobalState = _cloneDeep(globalState);\n\n      globalState = _cloneDeep(Object.keys(state).reduce(function (_globalState, changeKey) {\n        if (isMaster || _globalState.hasOwnProperty(changeKey)) {\n          changeKeys.push(changeKey);\n          return Object.assign(_globalState, _defineProperty({}, changeKey, state[changeKey]));\n        }\n\n        console.warn(\"[qiankun] '\".concat(changeKey, \"' not declared when init state\\uFF01\"));\n        return _globalState;\n      }, globalState));\n\n      if (changeKeys.length === 0) {\n        console.warn('[qiankun] state has not changed！');\n        return false;\n      }\n\n      emitGlobal(globalState, prevGlobalState);\n      return true;\n    },\n    // 注销该应用下的依赖\n    offGlobalStateChange: function offGlobalStateChange() {\n      delete deps[id];\n      return true;\n    }\n  };\n}"]}]}