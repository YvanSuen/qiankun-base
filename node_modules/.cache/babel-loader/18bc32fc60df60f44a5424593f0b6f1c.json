{"remainingRequest":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js!D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\patchers\\dynamicAppend\\forStrictSandbox.js","dependencies":[{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\patchers\\dynamicAppend\\forStrictSandbox.js","mtime":1631881155000},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618900774989},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js","mtime":1618886346176}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLndlYWstbWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CgovKioKICogQGF1dGhvciBLdWl0b3MKICogQHNpbmNlIDIwMjAtMTAtMTMKICovCmltcG9ydCB7IGdldEN1cnJlbnRSdW5uaW5nQXBwIH0gZnJvbSAnLi4vLi4vY29tbW9uJzsKaW1wb3J0IHsgaXNIaWphY2tpbmdUYWcsIHBhdGNoSFRNTER5bmFtaWNBcHBlbmRQcm90b3R5cGVGdW5jdGlvbnMsIHJhd0hlYWRBcHBlbmRDaGlsZCwgcmVidWlsZENTU1J1bGVzLCByZWNvcmRTdHlsZWRDb21wb25lbnRzQ1NTUnVsZXMgfSBmcm9tICcuL2NvbW1vbic7IC8vIEdldCBuYXRpdmUgZ2xvYmFsIHdpbmRvdyB3aXRoIGEgc2FuZGJveCBkaXNndXN0ZWQgd2F5LCB0aHVzIHdlIGNvdWxkIHNoYXJlIGl0IGJldHdlZW4gcWlhbmt1biBpbnN0YW5jZXPwn6SqCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYwoKdmFyIG5hdGl2ZUdsb2JhbCA9IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwpPYmplY3QuZGVmaW5lUHJvcGVydHkobmF0aXZlR2xvYmFsLCAnX19wcm94eUF0dGFjaENvbnRhaW5lckNvbmZpZ01hcF9fJywgewogIGVudW1lcmFibGU6IGZhbHNlLAogIHdyaXRhYmxlOiB0cnVlCn0pOyAvLyBTaGFyZSBwcm94eUF0dGFjaENvbnRhaW5lckNvbmZpZ01hcCBiZXR3ZWVuIG11bHRpcGxlIHFpYW5rdW4gaW5zdGFuY2UsIHRodXMgdGhleSBjb3VsZCBhY2Nlc3MgdGhlIHNhbWUgcmVjb3JkCgpuYXRpdmVHbG9iYWwuX19wcm94eUF0dGFjaENvbnRhaW5lckNvbmZpZ01hcF9fID0gbmF0aXZlR2xvYmFsLl9fcHJveHlBdHRhY2hDb250YWluZXJDb25maWdNYXBfXyB8fCBuZXcgV2Vha01hcCgpOwp2YXIgcHJveHlBdHRhY2hDb250YWluZXJDb25maWdNYXAgPSBuYXRpdmVHbG9iYWwuX19wcm94eUF0dGFjaENvbnRhaW5lckNvbmZpZ01hcF9fOwp2YXIgZWxlbWVudEF0dGFjaENvbnRhaW5lckNvbmZpZ01hcCA9IG5ldyBXZWFrTWFwKCk7CnZhciBkb2NDcmVhdGVQYXRjaGVkTWFwID0gbmV3IFdlYWtNYXAoKTsKCmZ1bmN0aW9uIHBhdGNoRG9jdW1lbnRDcmVhdGVFbGVtZW50KCkgewogIHZhciBkb2NDcmVhdGVFbGVtZW50Rm5CZWZvcmVPdmVyd3JpdGUgPSBkb2NDcmVhdGVQYXRjaGVkTWFwLmdldChkb2N1bWVudC5jcmVhdGVFbGVtZW50KTsKCiAgaWYgKCFkb2NDcmVhdGVFbGVtZW50Rm5CZWZvcmVPdmVyd3JpdGUpIHsKICAgIHZhciByYXdEb2N1bWVudENyZWF0ZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50OwoKICAgIERvY3VtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0YWdOYW1lLCBvcHRpb25zKSB7CiAgICAgIHZhciBlbGVtZW50ID0gcmF3RG9jdW1lbnRDcmVhdGVFbGVtZW50LmNhbGwodGhpcywgdGFnTmFtZSwgb3B0aW9ucyk7CgogICAgICBpZiAoaXNIaWphY2tpbmdUYWcodGFnTmFtZSkpIHsKICAgICAgICB2YXIgX3JlZiA9IGdldEN1cnJlbnRSdW5uaW5nQXBwKCkgfHwge30sCiAgICAgICAgICAgIGN1cnJlbnRSdW5uaW5nU2FuZGJveFByb3h5ID0gX3JlZi53aW5kb3c7CgogICAgICAgIGlmIChjdXJyZW50UnVubmluZ1NhbmRib3hQcm94eSkgewogICAgICAgICAgdmFyIHByb3h5Q29udGFpbmVyQ29uZmlnID0gcHJveHlBdHRhY2hDb250YWluZXJDb25maWdNYXAuZ2V0KGN1cnJlbnRSdW5uaW5nU2FuZGJveFByb3h5KTsKCiAgICAgICAgICBpZiAocHJveHlDb250YWluZXJDb25maWcpIHsKICAgICAgICAgICAgZWxlbWVudEF0dGFjaENvbnRhaW5lckNvbmZpZ01hcC5zZXQoZWxlbWVudCwgcHJveHlDb250YWluZXJDb25maWcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9OyAvLyBJdCBtZWFucyBpdCBoYXZlIGJlZW4gb3ZlcndyaXR0ZW4gd2hpbGUgY3JlYXRlRWxlbWVudCBpcyBhbiBvd24gcHJvcGVydHkgb2YgZG9jdW1lbnQKCgogICAgaWYgKGRvY3VtZW50Lmhhc093blByb3BlcnR5KCdjcmVhdGVFbGVtZW50JykpIHsKICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCA9IERvY3VtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50OwogICAgfQoKICAgIGRvY0NyZWF0ZVBhdGNoZWRNYXAuc2V0KERvY3VtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50LCByYXdEb2N1bWVudENyZWF0ZUVsZW1lbnQpOwogIH0KCiAgcmV0dXJuIGZ1bmN0aW9uIHVucGF0Y2goKSB7CiAgICBpZiAoZG9jQ3JlYXRlRWxlbWVudEZuQmVmb3JlT3ZlcndyaXRlKSB7CiAgICAgIERvY3VtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZG9jQ3JlYXRlRWxlbWVudEZuQmVmb3JlT3ZlcndyaXRlOwogICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50ID0gZG9jQ3JlYXRlRWxlbWVudEZuQmVmb3JlT3ZlcndyaXRlOwogICAgfQogIH07Cn0KCnZhciBib290c3RyYXBwaW5nUGF0Y2hDb3VudCA9IDA7CnZhciBtb3VudGluZ1BhdGNoQ291bnQgPSAwOwpleHBvcnQgZnVuY3Rpb24gcGF0Y2hTdHJpY3RTYW5kYm94KGFwcE5hbWUsIGFwcFdyYXBwZXJHZXR0ZXIsIHByb3h5KSB7CiAgdmFyIG1vdW50aW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiB0cnVlOwogIHZhciBzY29wZWRDU1MgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IGZhbHNlOwogIHZhciBleGNsdWRlQXNzZXRGaWx0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gNSA/IGFyZ3VtZW50c1s1XSA6IHVuZGVmaW5lZDsKICB2YXIgY29udGFpbmVyQ29uZmlnID0gcHJveHlBdHRhY2hDb250YWluZXJDb25maWdNYXAuZ2V0KHByb3h5KTsKCiAgaWYgKCFjb250YWluZXJDb25maWcpIHsKICAgIGNvbnRhaW5lckNvbmZpZyA9IHsKICAgICAgYXBwTmFtZTogYXBwTmFtZSwKICAgICAgcHJveHk6IHByb3h5LAogICAgICBhcHBXcmFwcGVyR2V0dGVyOiBhcHBXcmFwcGVyR2V0dGVyLAogICAgICBkeW5hbWljU3R5bGVTaGVldEVsZW1lbnRzOiBbXSwKICAgICAgc3RyaWN0R2xvYmFsOiB0cnVlLAogICAgICBleGNsdWRlQXNzZXRGaWx0ZXI6IGV4Y2x1ZGVBc3NldEZpbHRlciwKICAgICAgc2NvcGVkQ1NTOiBzY29wZWRDU1MKICAgIH07CiAgICBwcm94eUF0dGFjaENvbnRhaW5lckNvbmZpZ01hcC5zZXQocHJveHksIGNvbnRhaW5lckNvbmZpZyk7CiAgfSAvLyBhbGwgZHluYW1pYyBzdHlsZSBzaGVldHMgYXJlIHN0b3JlZCBpbiBwcm94eSBjb250YWluZXIKCgogIHZhciBfY29udGFpbmVyQ29uZmlnID0gY29udGFpbmVyQ29uZmlnLAogICAgICBkeW5hbWljU3R5bGVTaGVldEVsZW1lbnRzID0gX2NvbnRhaW5lckNvbmZpZy5keW5hbWljU3R5bGVTaGVldEVsZW1lbnRzOwogIHZhciB1bnBhdGNoRG9jdW1lbnRDcmVhdGUgPSBwYXRjaERvY3VtZW50Q3JlYXRlRWxlbWVudCgpOwogIHZhciB1bnBhdGNoRHluYW1pY0FwcGVuZFByb3RvdHlwZUZ1bmN0aW9ucyA9IHBhdGNoSFRNTER5bmFtaWNBcHBlbmRQcm90b3R5cGVGdW5jdGlvbnMoZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgIHJldHVybiBlbGVtZW50QXR0YWNoQ29udGFpbmVyQ29uZmlnTWFwLmhhcyhlbGVtZW50KTsKICB9LCBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgcmV0dXJuIGVsZW1lbnRBdHRhY2hDb250YWluZXJDb25maWdNYXAuZ2V0KGVsZW1lbnQpOwogIH0pOwogIGlmICghbW91bnRpbmcpIGJvb3RzdHJhcHBpbmdQYXRjaENvdW50Kys7CiAgaWYgKG1vdW50aW5nKSBtb3VudGluZ1BhdGNoQ291bnQrKzsKICByZXR1cm4gZnVuY3Rpb24gZnJlZSgpIHsKICAgIC8vIGJvb3RzdHJhcCBwYXRjaCBqdXN0IGNhbGxlZCBvbmNlIGJ1dCBpdHMgZnJlZXIgd2lsbCBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMKICAgIGlmICghbW91bnRpbmcgJiYgYm9vdHN0cmFwcGluZ1BhdGNoQ291bnQgIT09IDApIGJvb3RzdHJhcHBpbmdQYXRjaENvdW50LS07CiAgICBpZiAobW91bnRpbmcpIG1vdW50aW5nUGF0Y2hDb3VudC0tOwogICAgdmFyIGFsbE1pY3JvQXBwVW5tb3VudGVkID0gbW91bnRpbmdQYXRjaENvdW50ID09PSAwICYmIGJvb3RzdHJhcHBpbmdQYXRjaENvdW50ID09PSAwOyAvLyByZWxlYXNlIHRoZSBvdmVyd3JpdGUgcHJvdG90eXBlIGFmdGVyIGFsbCB0aGUgbWljcm8gYXBwcyB1bm1vdW50ZWQKCiAgICBpZiAoYWxsTWljcm9BcHBVbm1vdW50ZWQpIHsKICAgICAgdW5wYXRjaER5bmFtaWNBcHBlbmRQcm90b3R5cGVGdW5jdGlvbnMoKTsKICAgICAgdW5wYXRjaERvY3VtZW50Q3JlYXRlKCk7CiAgICB9CgogICAgcmVjb3JkU3R5bGVkQ29tcG9uZW50c0NTU1J1bGVzKGR5bmFtaWNTdHlsZVNoZWV0RWxlbWVudHMpOyAvLyBBcyBub3cgdGhlIHN1YiBhcHAgY29udGVudCBhbGwgd3JhcHBlZCB3aXRoIGEgc3BlY2lhbCBpZCBjb250YWluZXIsCiAgICAvLyB0aGUgZHluYW1pYyBzdHlsZSBzaGVldCB3b3VsZCBiZSByZW1vdmVkIGF1dG9tYXRpY2FsbHkgd2hpbGUgdW5tb3V0dGluZwoKICAgIHJldHVybiBmdW5jdGlvbiByZWJ1aWxkKCkgewogICAgICByZWJ1aWxkQ1NTUnVsZXMoZHluYW1pY1N0eWxlU2hlZXRFbGVtZW50cywgZnVuY3Rpb24gKHN0eWxlc2hlZXRFbGVtZW50KSB7CiAgICAgICAgdmFyIGFwcFdyYXBwZXIgPSBhcHBXcmFwcGVyR2V0dGVyKCk7CgogICAgICAgIGlmICghYXBwV3JhcHBlci5jb250YWlucyhzdHlsZXNoZWV0RWxlbWVudCkpIHsKICAgICAgICAgIHJhd0hlYWRBcHBlbmRDaGlsZC5jYWxsKGFwcFdyYXBwZXIsIHN0eWxlc2hlZXRFbGVtZW50KTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9KTsKICAgIH07CiAgfTsKfQ=="},{"version":3,"sources":["D:/qiankun微前台/Demo/qiankun/qiankun-base/node_modules/qiankun/es/sandbox/patchers/dynamicAppend/forStrictSandbox.js"],"names":["getCurrentRunningApp","isHijackingTag","patchHTMLDynamicAppendPrototypeFunctions","rawHeadAppendChild","rebuildCSSRules","recordStyledComponentsCSSRules","nativeGlobal","Function","Object","defineProperty","enumerable","writable","__proxyAttachContainerConfigMap__","WeakMap","proxyAttachContainerConfigMap","elementAttachContainerConfigMap","docCreatePatchedMap","patchDocumentCreateElement","docCreateElementFnBeforeOverwrite","get","document","createElement","rawDocumentCreateElement","Document","prototype","tagName","options","element","call","_ref","currentRunningSandboxProxy","window","proxyContainerConfig","set","hasOwnProperty","unpatch","bootstrappingPatchCount","mountingPatchCount","patchStrictSandbox","appName","appWrapperGetter","proxy","mounting","arguments","length","undefined","scopedCSS","excludeAssetFilter","containerConfig","dynamicStyleSheetElements","strictGlobal","_containerConfig","unpatchDocumentCreate","unpatchDynamicAppendPrototypeFunctions","has","free","allMicroAppUnmounted","rebuild","stylesheetElement","appWrapper","contains"],"mappings":"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","sourcesContent":["/**\n * @author Kuitos\n * @since 2020-10-13\n */\nimport { getCurrentRunningApp } from '../../common';\nimport { isHijackingTag, patchHTMLDynamicAppendPrototypeFunctions, rawHeadAppendChild, rebuildCSSRules, recordStyledComponentsCSSRules } from './common'; // Get native global window with a sandbox disgusted way, thus we could share it between qiankun instances🤪\n// eslint-disable-next-line no-new-func\n\nvar nativeGlobal = new Function('return this')();\nObject.defineProperty(nativeGlobal, '__proxyAttachContainerConfigMap__', {\n  enumerable: false,\n  writable: true\n}); // Share proxyAttachContainerConfigMap between multiple qiankun instance, thus they could access the same record\n\nnativeGlobal.__proxyAttachContainerConfigMap__ = nativeGlobal.__proxyAttachContainerConfigMap__ || new WeakMap();\nvar proxyAttachContainerConfigMap = nativeGlobal.__proxyAttachContainerConfigMap__;\nvar elementAttachContainerConfigMap = new WeakMap();\nvar docCreatePatchedMap = new WeakMap();\n\nfunction patchDocumentCreateElement() {\n  var docCreateElementFnBeforeOverwrite = docCreatePatchedMap.get(document.createElement);\n\n  if (!docCreateElementFnBeforeOverwrite) {\n    var rawDocumentCreateElement = document.createElement;\n\n    Document.prototype.createElement = function createElement(tagName, options) {\n      var element = rawDocumentCreateElement.call(this, tagName, options);\n\n      if (isHijackingTag(tagName)) {\n        var _ref = getCurrentRunningApp() || {},\n            currentRunningSandboxProxy = _ref.window;\n\n        if (currentRunningSandboxProxy) {\n          var proxyContainerConfig = proxyAttachContainerConfigMap.get(currentRunningSandboxProxy);\n\n          if (proxyContainerConfig) {\n            elementAttachContainerConfigMap.set(element, proxyContainerConfig);\n          }\n        }\n      }\n\n      return element;\n    }; // It means it have been overwritten while createElement is an own property of document\n\n\n    if (document.hasOwnProperty('createElement')) {\n      document.createElement = Document.prototype.createElement;\n    }\n\n    docCreatePatchedMap.set(Document.prototype.createElement, rawDocumentCreateElement);\n  }\n\n  return function unpatch() {\n    if (docCreateElementFnBeforeOverwrite) {\n      Document.prototype.createElement = docCreateElementFnBeforeOverwrite;\n      document.createElement = docCreateElementFnBeforeOverwrite;\n    }\n  };\n}\n\nvar bootstrappingPatchCount = 0;\nvar mountingPatchCount = 0;\nexport function patchStrictSandbox(appName, appWrapperGetter, proxy) {\n  var mounting = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  var scopedCSS = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var excludeAssetFilter = arguments.length > 5 ? arguments[5] : undefined;\n  var containerConfig = proxyAttachContainerConfigMap.get(proxy);\n\n  if (!containerConfig) {\n    containerConfig = {\n      appName: appName,\n      proxy: proxy,\n      appWrapperGetter: appWrapperGetter,\n      dynamicStyleSheetElements: [],\n      strictGlobal: true,\n      excludeAssetFilter: excludeAssetFilter,\n      scopedCSS: scopedCSS\n    };\n    proxyAttachContainerConfigMap.set(proxy, containerConfig);\n  } // all dynamic style sheets are stored in proxy container\n\n\n  var _containerConfig = containerConfig,\n      dynamicStyleSheetElements = _containerConfig.dynamicStyleSheetElements;\n  var unpatchDocumentCreate = patchDocumentCreateElement();\n  var unpatchDynamicAppendPrototypeFunctions = patchHTMLDynamicAppendPrototypeFunctions(function (element) {\n    return elementAttachContainerConfigMap.has(element);\n  }, function (element) {\n    return elementAttachContainerConfigMap.get(element);\n  });\n  if (!mounting) bootstrappingPatchCount++;\n  if (mounting) mountingPatchCount++;\n  return function free() {\n    // bootstrap patch just called once but its freer will be called multiple times\n    if (!mounting && bootstrappingPatchCount !== 0) bootstrappingPatchCount--;\n    if (mounting) mountingPatchCount--;\n    var allMicroAppUnmounted = mountingPatchCount === 0 && bootstrappingPatchCount === 0; // release the overwrite prototype after all the micro apps unmounted\n\n    if (allMicroAppUnmounted) {\n      unpatchDynamicAppendPrototypeFunctions();\n      unpatchDocumentCreate();\n    }\n\n    recordStyledComponentsCSSRules(dynamicStyleSheetElements); // As now the sub app content all wrapped with a special id container,\n    // the dynamic style sheet would be removed automatically while unmoutting\n\n    return function rebuild() {\n      rebuildCSSRules(dynamicStyleSheetElements, function (stylesheetElement) {\n        var appWrapper = appWrapperGetter();\n\n        if (!appWrapper.contains(stylesheetElement)) {\n          rawHeadAppendChild.call(appWrapper, stylesheetElement);\n          return true;\n        }\n\n        return false;\n      });\n    };\n  };\n}"]}]}