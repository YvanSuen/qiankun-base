{"remainingRequest":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js!D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\patchers\\historyListener.js","dependencies":[{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\patchers\\historyListener.js","mtime":1631881155000},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618900774989},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js","mtime":1618886346176}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0IF9pc0Z1bmN0aW9uIGZyb20gImxvZGFzaC9pc0Z1bmN0aW9uIjsKaW1wb3J0IF9ub29wIGZyb20gImxvZGFzaC9ub29wIjsKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcGF0Y2goKSB7CiAgLy8gRklYTUUgdW1pIHVubW91bnQgZmVhdHVyZSByZXF1ZXN0CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycwogIHZhciByYXdIaXN0b3J5TGlzdGVuID0gZnVuY3Rpb24gcmF3SGlzdG9yeUxpc3RlbihfKSB7CiAgICByZXR1cm4gX25vb3A7CiAgfTsKCiAgdmFyIGhpc3RvcnlMaXN0ZW5lcnMgPSBbXTsKICB2YXIgaGlzdG9yeVVuTGlzdGVucyA9IFtdOwoKICBpZiAod2luZG93LmdfaGlzdG9yeSAmJiBfaXNGdW5jdGlvbih3aW5kb3cuZ19oaXN0b3J5Lmxpc3RlbikpIHsKICAgIHJhd0hpc3RvcnlMaXN0ZW4gPSB3aW5kb3cuZ19oaXN0b3J5Lmxpc3Rlbi5iaW5kKHdpbmRvdy5nX2hpc3RvcnkpOwoKICAgIHdpbmRvdy5nX2hpc3RvcnkubGlzdGVuID0gZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgIGhpc3RvcnlMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgICAgIHZhciB1bkxpc3RlbiA9IHJhd0hpc3RvcnlMaXN0ZW4obGlzdGVuZXIpOwogICAgICBoaXN0b3J5VW5MaXN0ZW5zLnB1c2godW5MaXN0ZW4pOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHVuTGlzdGVuKCk7CiAgICAgICAgaGlzdG9yeVVuTGlzdGVucy5zcGxpY2UoaGlzdG9yeVVuTGlzdGVucy5pbmRleE9mKHVuTGlzdGVuKSwgMSk7CiAgICAgICAgaGlzdG9yeUxpc3RlbmVycy5zcGxpY2UoaGlzdG9yeUxpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKSwgMSk7CiAgICAgIH07CiAgICB9OwogIH0KCiAgcmV0dXJuIGZ1bmN0aW9uIGZyZWUoKSB7CiAgICB2YXIgcmVidWlsZCA9IF9ub29wOwogICAgLyoKICAgICDov5jlrZjlnKjkvZnph48gbGlzdGVuZXIg6KGo5piO5pyq6KKr5Y246L2977yM5a2Y5Zyo5Lik56eN5oOF5Ya1CiAgICAgMS4g5bqU55So5ZyoIHVubW91dCDml7bmnKrmraPnoa7ljbjovb0gbGlzdGVuZXIKICAgICAyLiBsaXN0ZW5lciDmmK/lupTnlKggbW91bnQg5LmL5YmN57uR5a6a55qE77yMCiAgICAg56ys5LqM56eN5oOF5Ya15LiL5bqU55So5Zyo5LiL5qyhIG1vdW50IOS5i+WJjemcgOmHjeaWsOe7keWumuivpSBsaXN0ZW5lcgogICAgICovCgogICAgaWYgKGhpc3RvcnlMaXN0ZW5lcnMubGVuZ3RoKSB7CiAgICAgIHJlYnVpbGQgPSBmdW5jdGlvbiByZWJ1aWxkKCkgewogICAgICAgIC8vIOW/hemhu+S9v+eUqCB3aW5kb3cuZ19oaXN0b3J5Lmxpc3RlbiDnmoTmlrnlvI/ph43mlrDnu5HlrpogbGlzdGVuZXLvvIzku47ogIzog73kv53or4EgcmVidWlsZCDov5npg6jliIbkuZ/og73ooqvmjZXojrfliLDvvIzlkKbliJnlnKjlupTnlKjljbjovb3lkI7ml6Dms5XmraPnoa7nmoTnp7vpmaTov5npg6jliIblia/kvZznlKgKICAgICAgICBoaXN0b3J5TGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgICAgICByZXR1cm4gd2luZG93LmdfaGlzdG9yeS5saXN0ZW4obGlzdGVuZXIpOwogICAgICAgIH0pOwogICAgICB9OwogICAgfSAvLyDljbjovb3kvZnkuIvnmoQgbGlzdGVuZXIKCgogICAgaGlzdG9yeVVuTGlzdGVucy5mb3JFYWNoKGZ1bmN0aW9uICh1bkxpc3RlbikgewogICAgICByZXR1cm4gdW5MaXN0ZW4oKTsKICAgIH0pOyAvLyByZXN0b3JlCgogICAgaWYgKHdpbmRvdy5nX2hpc3RvcnkgJiYgX2lzRnVuY3Rpb24od2luZG93LmdfaGlzdG9yeS5saXN0ZW4pKSB7CiAgICAgIHdpbmRvdy5nX2hpc3RvcnkubGlzdGVuID0gcmF3SGlzdG9yeUxpc3RlbjsKICAgIH0KCiAgICByZXR1cm4gcmVidWlsZDsKICB9Owp9"},{"version":3,"sources":["D:/qiankun微前台/Demo/qiankun/qiankun-base/node_modules/qiankun/es/sandbox/patchers/historyListener.js"],"names":["_isFunction","_noop","patch","rawHistoryListen","_","historyListeners","historyUnListens","window","g_history","listen","bind","listener","push","unListen","splice","indexOf","free","rebuild","length","forEach"],"mappings":";AAAA,OAAOA,WAAP,MAAwB,mBAAxB;AACA,OAAOC,KAAP,MAAkB,aAAlB;AACA,eAAe,SAASC,KAAT,GAAiB;AAC9B;AACA;AACA,MAAIC,gBAAgB,GAAG,SAASA,gBAAT,CAA0BC,CAA1B,EAA6B;AAClD,WAAOH,KAAP;AACD,GAFD;;AAIA,MAAII,gBAAgB,GAAG,EAAvB;AACA,MAAIC,gBAAgB,GAAG,EAAvB;;AAEA,MAAIC,MAAM,CAACC,SAAP,IAAoBR,WAAW,CAACO,MAAM,CAACC,SAAP,CAAiBC,MAAlB,CAAnC,EAA8D;AAC5DN,IAAAA,gBAAgB,GAAGI,MAAM,CAACC,SAAP,CAAiBC,MAAjB,CAAwBC,IAAxB,CAA6BH,MAAM,CAACC,SAApC,CAAnB;;AAEAD,IAAAA,MAAM,CAACC,SAAP,CAAiBC,MAAjB,GAA0B,UAAUE,QAAV,EAAoB;AAC5CN,MAAAA,gBAAgB,CAACO,IAAjB,CAAsBD,QAAtB;AACA,UAAIE,QAAQ,GAAGV,gBAAgB,CAACQ,QAAD,CAA/B;AACAL,MAAAA,gBAAgB,CAACM,IAAjB,CAAsBC,QAAtB;AACA,aAAO,YAAY;AACjBA,QAAAA,QAAQ;AACRP,QAAAA,gBAAgB,CAACQ,MAAjB,CAAwBR,gBAAgB,CAACS,OAAjB,CAAyBF,QAAzB,CAAxB,EAA4D,CAA5D;AACAR,QAAAA,gBAAgB,CAACS,MAAjB,CAAwBT,gBAAgB,CAACU,OAAjB,CAAyBJ,QAAzB,CAAxB,EAA4D,CAA5D;AACD,OAJD;AAKD,KATD;AAUD;;AAED,SAAO,SAASK,IAAT,GAAgB;AACrB,QAAIC,OAAO,GAAGhB,KAAd;AACA;AACJ;AACA;AACA;AACA;AACA;;AAEI,QAAII,gBAAgB,CAACa,MAArB,EAA6B;AAC3BD,MAAAA,OAAO,GAAG,SAASA,OAAT,GAAmB;AAC3B;AACAZ,QAAAA,gBAAgB,CAACc,OAAjB,CAAyB,UAAUR,QAAV,EAAoB;AAC3C,iBAAOJ,MAAM,CAACC,SAAP,CAAiBC,MAAjB,CAAwBE,QAAxB,CAAP;AACD,SAFD;AAGD,OALD;AAMD,KAhBoB,CAgBnB;;;AAGFL,IAAAA,gBAAgB,CAACa,OAAjB,CAAyB,UAAUN,QAAV,EAAoB;AAC3C,aAAOA,QAAQ,EAAf;AACD,KAFD,EAnBqB,CAqBjB;;AAEJ,QAAIN,MAAM,CAACC,SAAP,IAAoBR,WAAW,CAACO,MAAM,CAACC,SAAP,CAAiBC,MAAlB,CAAnC,EAA8D;AAC5DF,MAAAA,MAAM,CAACC,SAAP,CAAiBC,MAAjB,GAA0BN,gBAA1B;AACD;;AAED,WAAOc,OAAP;AACD,GA5BD;AA6BD","sourcesContent":["import _isFunction from \"lodash/isFunction\";\nimport _noop from \"lodash/noop\";\nexport default function patch() {\n  // FIXME umi unmount feature request\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  var rawHistoryListen = function rawHistoryListen(_) {\n    return _noop;\n  };\n\n  var historyListeners = [];\n  var historyUnListens = [];\n\n  if (window.g_history && _isFunction(window.g_history.listen)) {\n    rawHistoryListen = window.g_history.listen.bind(window.g_history);\n\n    window.g_history.listen = function (listener) {\n      historyListeners.push(listener);\n      var unListen = rawHistoryListen(listener);\n      historyUnListens.push(unListen);\n      return function () {\n        unListen();\n        historyUnListens.splice(historyUnListens.indexOf(unListen), 1);\n        historyListeners.splice(historyListeners.indexOf(listener), 1);\n      };\n    };\n  }\n\n  return function free() {\n    var rebuild = _noop;\n    /*\n     还存在余量 listener 表明未被卸载，存在两种情况\n     1. 应用在 unmout 时未正确卸载 listener\n     2. listener 是应用 mount 之前绑定的，\n     第二种情况下应用在下次 mount 之前需重新绑定该 listener\n     */\n\n    if (historyListeners.length) {\n      rebuild = function rebuild() {\n        // 必须使用 window.g_history.listen 的方式重新绑定 listener，从而能保证 rebuild 这部分也能被捕获到，否则在应用卸载后无法正确的移除这部分副作用\n        historyListeners.forEach(function (listener) {\n          return window.g_history.listen(listener);\n        });\n      };\n    } // 卸载余下的 listener\n\n\n    historyUnListens.forEach(function (unListen) {\n      return unListen();\n    }); // restore\n\n    if (window.g_history && _isFunction(window.g_history.listen)) {\n      window.g_history.listen = rawHistoryListen;\n    }\n\n    return rebuild;\n  };\n}"]}]}