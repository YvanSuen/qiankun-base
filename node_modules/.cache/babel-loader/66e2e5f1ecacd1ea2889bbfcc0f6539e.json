{"remainingRequest":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js!D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\snapshotSandbox.js","dependencies":[{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\qiankun\\es\\sandbox\\snapshotSandbox.js","mtime":1631881155000},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618900774989},{"path":"D:\\qiankun微前台\\Demo\\qiankun\\qiankun-base\\node_modules\\babel-loader\\lib\\index.js","mtime":1618886346176}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IHsgU2FuZEJveFR5cGUgfSBmcm9tICcuLi9pbnRlcmZhY2VzJzsKCmZ1bmN0aW9uIGl0ZXIob2JqLCBjYWxsYmFja0ZuKSB7CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGd1YXJkLWZvci1pbiwgbm8tcmVzdHJpY3RlZC1zeW50YXgKICBmb3IgKHZhciBwcm9wIGluIG9iaikgewogICAgLy8gcGF0Y2ggZm9yIGNsZWFySW50ZXJ2YWwgZm9yIGNvbXBhdGlibGUgcmVhc29uLCBzZWUgIzE0OTAKICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkocHJvcCkgfHwgcHJvcCA9PT0gJ2NsZWFySW50ZXJ2YWwnKSB7CiAgICAgIGNhbGxiYWNrRm4ocHJvcCk7CiAgICB9CiAgfQp9Ci8qKgogKiDln7rkuo4gZGlmZiDmlrnlvI/lrp7njrDnmoTmspnnrrHvvIznlKjkuo7kuI3mlK/mjIEgUHJveHkg55qE5L2O54mI5pys5rWP6KeI5ZmoCiAqLwoKCnZhciBTbmFwc2hvdFNhbmRib3ggPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFNuYXBzaG90U2FuZGJveChuYW1lKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU25hcHNob3RTYW5kYm94KTsKCiAgICB0aGlzLnNhbmRib3hSdW5uaW5nID0gdHJ1ZTsKICAgIHRoaXMubW9kaWZ5UHJvcHNNYXAgPSB7fTsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnByb3h5ID0gd2luZG93OwogICAgdGhpcy50eXBlID0gU2FuZEJveFR5cGUuU25hcHNob3Q7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU25hcHNob3RTYW5kYm94LCBbewogICAga2V5OiAiYWN0aXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhY3RpdmUoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7IC8vIOiusOW9leW9k+WJjeW/q+eFpwoKCiAgICAgIHRoaXMud2luZG93U25hcHNob3QgPSB7fTsKICAgICAgaXRlcih3aW5kb3csIGZ1bmN0aW9uIChwcm9wKSB7CiAgICAgICAgX3RoaXMud2luZG93U25hcHNob3RbcHJvcF0gPSB3aW5kb3dbcHJvcF07CiAgICAgIH0pOyAvLyDmgaLlpI3kuYvliY3nmoTlj5jmm7QKCiAgICAgIE9iamVjdC5rZXlzKHRoaXMubW9kaWZ5UHJvcHNNYXApLmZvckVhY2goZnVuY3Rpb24gKHApIHsKICAgICAgICB3aW5kb3dbcF0gPSBfdGhpcy5tb2RpZnlQcm9wc01hcFtwXTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2FuZGJveFJ1bm5pbmcgPSB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogImluYWN0aXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbmFjdGl2ZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLm1vZGlmeVByb3BzTWFwID0ge307CiAgICAgIGl0ZXIod2luZG93LCBmdW5jdGlvbiAocHJvcCkgewogICAgICAgIGlmICh3aW5kb3dbcHJvcF0gIT09IF90aGlzMi53aW5kb3dTbmFwc2hvdFtwcm9wXSkgewogICAgICAgICAgLy8g6K6w5b2V5Y+Y5pu077yM5oGi5aSN546v5aKDCiAgICAgICAgICBfdGhpczIubW9kaWZ5UHJvcHNNYXBbcHJvcF0gPSB3aW5kb3dbcHJvcF07CiAgICAgICAgICB3aW5kb3dbcHJvcF0gPSBfdGhpczIud2luZG93U25hcHNob3RbcHJvcF07CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JykgewogICAgICAgIGNvbnNvbGUuaW5mbygiW3FpYW5rdW46c2FuZGJveF0gIi5jb25jYXQodGhpcy5uYW1lLCAiIG9yaWdpbiB3aW5kb3cgcmVzdG9yZS4uLiIpLCBPYmplY3Qua2V5cyh0aGlzLm1vZGlmeVByb3BzTWFwKSk7CiAgICAgIH0KCiAgICAgIHRoaXMuc2FuZGJveFJ1bm5pbmcgPSBmYWxzZTsKICAgIH0KICB9XSk7CgogIHJldHVybiBTbmFwc2hvdFNhbmRib3g7Cn0oKTsKCmV4cG9ydCB7IFNuYXBzaG90U2FuZGJveCBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["D:/qiankun微前台/Demo/qiankun/qiankun-base/node_modules/qiankun/es/sandbox/snapshotSandbox.js"],"names":["_classCallCheck","_createClass","SandBoxType","iter","obj","callbackFn","prop","hasOwnProperty","SnapshotSandbox","name","sandboxRunning","modifyPropsMap","proxy","window","type","Snapshot","key","value","active","_this","windowSnapshot","Object","keys","forEach","p","inactive","_this2","process","env","NODE_ENV","console","info","concat","default"],"mappings":";;;AAAA,OAAOA,eAAP,MAA4B,2CAA5B;AACA,OAAOC,YAAP,MAAyB,wCAAzB;AACA,SAASC,WAAT,QAA4B,eAA5B;;AAEA,SAASC,IAAT,CAAcC,GAAd,EAAmBC,UAAnB,EAA+B;AAC7B;AACA,OAAK,IAAIC,IAAT,IAAiBF,GAAjB,EAAsB;AACpB;AACA,QAAIA,GAAG,CAACG,cAAJ,CAAmBD,IAAnB,KAA4BA,IAAI,KAAK,eAAzC,EAA0D;AACxDD,MAAAA,UAAU,CAACC,IAAD,CAAV;AACD;AACF;AACF;AACD;AACA;AACA;;;AAGA,IAAIE,eAAe,GAAG,aAAa,YAAY;AAC7C,WAASA,eAAT,CAAyBC,IAAzB,EAA+B;AAC7BT,IAAAA,eAAe,CAAC,IAAD,EAAOQ,eAAP,CAAf;;AAEA,SAAKE,cAAL,GAAsB,IAAtB;AACA,SAAKC,cAAL,GAAsB,EAAtB;AACA,SAAKF,IAAL,GAAYA,IAAZ;AACA,SAAKG,KAAL,GAAaC,MAAb;AACA,SAAKC,IAAL,GAAYZ,WAAW,CAACa,QAAxB;AACD;;AAEDd,EAAAA,YAAY,CAACO,eAAD,EAAkB,CAAC;AAC7BQ,IAAAA,GAAG,EAAE,QADwB;AAE7BC,IAAAA,KAAK,EAAE,SAASC,MAAT,GAAkB;AACvB,UAAIC,KAAK,GAAG,IAAZ,CADuB,CAGvB;;;AACA,WAAKC,cAAL,GAAsB,EAAtB;AACAjB,MAAAA,IAAI,CAACU,MAAD,EAAS,UAAUP,IAAV,EAAgB;AAC3Ba,QAAAA,KAAK,CAACC,cAAN,CAAqBd,IAArB,IAA6BO,MAAM,CAACP,IAAD,CAAnC;AACD,OAFG,CAAJ,CALuB,CAOnB;;AAEJe,MAAAA,MAAM,CAACC,IAAP,CAAY,KAAKX,cAAjB,EAAiCY,OAAjC,CAAyC,UAAUC,CAAV,EAAa;AACpDX,QAAAA,MAAM,CAACW,CAAD,CAAN,GAAYL,KAAK,CAACR,cAAN,CAAqBa,CAArB,CAAZ;AACD,OAFD;AAGA,WAAKd,cAAL,GAAsB,IAAtB;AACD;AAf4B,GAAD,EAgB3B;AACDM,IAAAA,GAAG,EAAE,UADJ;AAEDC,IAAAA,KAAK,EAAE,SAASQ,QAAT,GAAoB;AACzB,UAAIC,MAAM,GAAG,IAAb;;AAEA,WAAKf,cAAL,GAAsB,EAAtB;AACAR,MAAAA,IAAI,CAACU,MAAD,EAAS,UAAUP,IAAV,EAAgB;AAC3B,YAAIO,MAAM,CAACP,IAAD,CAAN,KAAiBoB,MAAM,CAACN,cAAP,CAAsBd,IAAtB,CAArB,EAAkD;AAChD;AACAoB,UAAAA,MAAM,CAACf,cAAP,CAAsBL,IAAtB,IAA8BO,MAAM,CAACP,IAAD,CAApC;AACAO,UAAAA,MAAM,CAACP,IAAD,CAAN,GAAeoB,MAAM,CAACN,cAAP,CAAsBd,IAAtB,CAAf;AACD;AACF,OANG,CAAJ;;AAQA,UAAIqB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;AAC1CC,QAAAA,OAAO,CAACC,IAAR,CAAa,qBAAqBC,MAArB,CAA4B,KAAKvB,IAAjC,EAAuC,2BAAvC,CAAb,EAAkFY,MAAM,CAACC,IAAP,CAAY,KAAKX,cAAjB,CAAlF;AACD;;AAED,WAAKD,cAAL,GAAsB,KAAtB;AACD;AAnBA,GAhB2B,CAAlB,CAAZ;;AAsCA,SAAOF,eAAP;AACD,CAlDkC,EAAnC;;AAoDA,SAASA,eAAe,IAAIyB,OAA5B","sourcesContent":["import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport { SandBoxType } from '../interfaces';\n\nfunction iter(obj, callbackFn) {\n  // eslint-disable-next-line guard-for-in, no-restricted-syntax\n  for (var prop in obj) {\n    // patch for clearInterval for compatible reason, see #1490\n    if (obj.hasOwnProperty(prop) || prop === 'clearInterval') {\n      callbackFn(prop);\n    }\n  }\n}\n/**\n * 基于 diff 方式实现的沙箱，用于不支持 Proxy 的低版本浏览器\n */\n\n\nvar SnapshotSandbox = /*#__PURE__*/function () {\n  function SnapshotSandbox(name) {\n    _classCallCheck(this, SnapshotSandbox);\n\n    this.sandboxRunning = true;\n    this.modifyPropsMap = {};\n    this.name = name;\n    this.proxy = window;\n    this.type = SandBoxType.Snapshot;\n  }\n\n  _createClass(SnapshotSandbox, [{\n    key: \"active\",\n    value: function active() {\n      var _this = this;\n\n      // 记录当前快照\n      this.windowSnapshot = {};\n      iter(window, function (prop) {\n        _this.windowSnapshot[prop] = window[prop];\n      }); // 恢复之前的变更\n\n      Object.keys(this.modifyPropsMap).forEach(function (p) {\n        window[p] = _this.modifyPropsMap[p];\n      });\n      this.sandboxRunning = true;\n    }\n  }, {\n    key: \"inactive\",\n    value: function inactive() {\n      var _this2 = this;\n\n      this.modifyPropsMap = {};\n      iter(window, function (prop) {\n        if (window[prop] !== _this2.windowSnapshot[prop]) {\n          // 记录变更，恢复环境\n          _this2.modifyPropsMap[prop] = window[prop];\n          window[prop] = _this2.windowSnapshot[prop];\n        }\n      });\n\n      if (process.env.NODE_ENV === 'development') {\n        console.info(\"[qiankun:sandbox] \".concat(this.name, \" origin window restore...\"), Object.keys(this.modifyPropsMap));\n      }\n\n      this.sandboxRunning = false;\n    }\n  }]);\n\n  return SnapshotSandbox;\n}();\n\nexport { SnapshotSandbox as default };"]}]}